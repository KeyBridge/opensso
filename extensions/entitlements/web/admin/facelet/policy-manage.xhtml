<?xml version='1.0' encoding='UTF-8'?>
<ui:composition
    template="template/page.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:o="http://opensso.dev.java.net">
    <ui:define name="panel-title">
        <ice:outputText value="#{msg.policyManagePanelTitle}" />
    </ui:define>
    <ui:define name="panel-details">
        <ice:outputText value="#{msg.policyManagePanelDetails}" />
    </ui:define>
    <ui:define name="panel-body">
        <ui:repeat
            var="privilegeBean"
            value="#{policyManageHandler.policyManageBean.privilegeBeans}">
            <o:infopopup
                visible="#{privilegeBean.resourcePopupVisible}"
                handler="#{policyManageHandler}"
                closeListenerMethod="viewResourcesPopupListener"
                title="#{privilegeBean.name}: Resources">
                <ui:define name="attributes">
                    <f:attribute
                        name="privilegeBean"
                        value="#{privilegeBean}"/>
                </ui:define>
                <ui:define name="body">
                    <pre>
                    <ice:outputText
                        value="#{privilegeBean.viewEntitlement.resourcesToFormattedString}"/>
                    </pre>
                </ui:define>
            </o:infopopup>
            <o:infopopup
                visible="#{privilegeBean.conditionPopupVisible}"
                handler="#{policyManageHandler}"
                closeListenerMethod="viewConditionPopupListener"
                title="#{privilegeBean.name}: Conditions">
                <ui:define name="attributes">
                    <f:attribute
                        name="privilegeBean"
                        value="#{privilegeBean}"/>
                </ui:define>
                <ui:define name="body">
                    <pre>
                    <ice:outputText
                        value="#{privilegeBean.viewCondition.toFormattedString}"/>
                    </pre>
                </ui:define>
            </o:infopopup>
        </ui:repeat>
        <div class="section-outer">
            <o:box>
                <ui:define name="body">
                    <div class="section-inner">
                        <ice:dataTable
                            var="privilegeBean"
                            value="#{policyManageHandler.policyManageBean.privilegeBeans}"
                            sortColumn="#{policyManageBean.policyManageTableBean.sortKey.column}"
                            sortAscending="#{policyManageBean.policyManageTableBean.sortKey.ascending}">
                            <ice:column>
                                <f:facet name="header">
                                    <ice:commandSortHeader
                                        columnName="name"
                                        actionListener="#{policyManageHandler.sortTableListener}">
                                        <ice:outputText
                                            value="Name"/>
                                    </ice:commandSortHeader>
                                </f:facet>
                                <ice:outputText
                                    value="#{privilegeBean.name}"/>
                            </ice:column>
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Resources"/>
                                </f:facet>
                                <ice:panelGrid
                                    columns="2">
                                    <ice:outputText
                                        value="#{o:truncate(privilegeBean.viewEntitlement.resourcesToString, policyManageBean.policyManageTableBean.cellWidth)}"/>
                                    <ice:commandLink
                                        styleClass="command-link"
                                        actionListener="#{policyManageHandler.viewResourcesPopupListener}"
                                        visible="#{o:length(privilegeBean.viewEntitlement.resourcesToString) > policyManageBean.policyManageTableBean.cellWidth}">
                                        <f:attribute
                                            name="privilegeBean"
                                            value="#{privilegeBean}"/>
                                        <ice:outputText
                                            visible="#{o:length(privilegeBean.viewEntitlement.resourcesToString) > policyManageBean.policyManageTableBean.cellWidth}"
                                            value="...View (#{o:size(privilegeBean.viewEntitlement.resources)} total)"/>
                                    </ice:commandLink>
                                </ice:panelGrid>
                            </ice:column>
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Subjects"/>
                                </f:facet>
                                <ice:outputText
                                    value="#{o:truncate(privilegeBean.viewSubjectToString, policyManageBean.policyManageTableBean.cellWidth)}"/>
                            </ice:column>
                            <ice:column>
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Conditions"/>
                                </f:facet>
                                <ice:panelGrid
                                    columns="2">
                                    <ice:outputText
                                        value="#{o:truncate(privilegeBean.viewCondition.toString, policyManageBean.policyManageTableBean.cellWidth)}"/>
                                    <ice:commandLink
                                        visible="#{o:length(privilegeBean.viewCondition.toString) > policyManageBean.policyManageTableBean.cellWidth}"
                                        styleClass="command-link"
                                        actionListener="#{policyManageHandler.viewConditionPopupListener}">
                                        <f:attribute
                                            name="privilegeBean"
                                            value="#{privilegeBean}"/>
                                        <ice:outputText
                                            value="...View (#{privilegeBean.viewCondition.size} total)"/>
                                    </ice:commandLink>
                                </ice:panelGrid>
                            </ice:column>
                        </ice:dataTable>
                    </div>
                </ui:define>
            </o:box>
        </div>
    </ui:define>
</ui:composition>
