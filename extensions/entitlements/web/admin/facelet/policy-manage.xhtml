<?xml version='1.0' encoding='UTF-8'?>
<ui:composition
    template="template/page.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:o="http://opensso.dev.java.net">

    <ui:define name="panel-title">
        <ice:outputText value="#{msg.policyManagePanelTitle}" />
    </ui:define>
    <ui:define name="panel-details">
        <ice:outputText value="#{msg.policyManagePanelDetails}" />
    </ui:define>
    <ui:define name="panel-body">
        <ui:include src="/admin/facelet/template/policy-manage-view-options-popup.xhtml"/>
        <div class="section-outer">
            <o:box>
                <ui:define name="body">
                    <div class="section-inner">
                        <span class="section-head">
                            <span class="section-title">
                                <ice:outputText value="Policies (#{o:size(policyManageHandler.policyManageBean.privilegeBeans)})"/>
                            </span>
                            <span class="section-links">
                                <ice:panelGrid
                                    columns="3">
                                    <o:clink
                                        type="view-options"
                                        handler="#{policyManageHandler}"
                                        listenerMethod="viewOptionsListener"/>
                                </ice:panelGrid>
                            </span>
                        </span>
                        <div class="clear"></div>
                        <ice:panelGroup
                            rendered="#{o:size(policyManageHandler.policyManageBean.privilegeBeans) == 0}">
                            <ice:outputText
                                value="No policies"/>
                        </ice:panelGroup>
                        <ice:dataTable
                            rendered="#{o:size(policyManageHandler.policyManageBean.privilegeBeans) > 0}"
                            id="policyManageTable"
                            var="privilegeBean"
                            styleClass="policy-manage"
                            value="#{policyManageHandler.policyManageBean.privilegeBeans}"
                            sortColumn="#{policyManageBean.policyManageTableBean.sortKey.column}"
                            sortAscending="#{policyManageBean.policyManageTableBean.sortKey.ascending}"
                            resizable="true">

                            <ice:column>
                                <f:facet name="header">
                                    <ice:commandSortHeader
                                        columnName="name"
                                        actionListener="#{policyManageHandler.sortTableListener}">
                                        <ice:outputText
                                            value="Name"/>
                                    </ice:commandSortHeader>
                                </f:facet>
                                <ice:outputText
                                    visible="#{true}"
                                    effect="#{privilegeBean.nameCellEffect}"
                                    value="#{privilegeBean.name}"/>
                            </ice:column>
                            <ice:column
                                rendered="#{policyManageBean.policyManageTableBean.resourcesColumnVisible}">
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Resources"/>
                                </f:facet>
                                <ice:panelGroup
                                    visible="#{true}"
                                    effect="#{privilegeBean.resourcesCellEffect}"
                                    panelTooltip="resourcesTooltip">
                                    <ice:outputText
                                        value="#{privilegeBean.viewEntitlement.resourcesToString}"/>
                                </ice:panelGroup>
                                <o:tooltip
                                    tooltipId="resourcesTooltip"
                                    title="#{privilegeBean.name}: resources (#{o:size(privilegeBean.viewEntitlement.resources)})">
                                    <ui:define name="body">
                                        <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.resourcesToFormattedString}"/>
                                        </pre>
                                    </ui:define>
                                </o:tooltip>
                            </ice:column>
                            <ice:column
                                rendered="#{policyManageBean.policyManageTableBean.subjectColumnVisible}">
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Subjects"/>
                                </f:facet>
                                <ice:panelGroup
                                    visible="#{true}"
                                    effect="#{privilegeBean.subjectCellEffect}"
                                    panelTooltip="subjectTooltip">
                                    <ice:outputText
                                        value="#{privilegeBean.viewSubject.toString}"/>
                                </ice:panelGroup>
                                <o:tooltip
                                    tooltipId="subjectTooltip"
                                    title="#{privilegeBean.name}: subjects (#{privilegeBean.viewSubject.size})">
                                    <ui:define name="body">
                                        <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewSubject.toFormattedString}"/>
                                        </pre>
                                    </ui:define>
                                </o:tooltip>
                            </ice:column>
                            <ice:column
                                rendered="#{policyManageBean.policyManageTableBean.conditionColumnVisible}">
                                <f:facet name="header">
                                    <ice:outputText
                                        value="Conditions"/>
                                </f:facet>
                                <ice:panelGroup
                                    visible="#{true}"
                                    effect="#{privilegeBean.conditionCellEffect}"
                                    panelTooltip="conditionTooltip">
                                    <ice:outputText
                                        value="#{privilegeBean.viewCondition.toString}"/>
                                </ice:panelGroup>
                                <o:tooltip
                                    tooltipId="conditionTooltip"
                                    title="#{privilegeBean.name}: conditions (#{privilegeBean.viewCondition.size})">
                                    <ui:define name="body">
                                        <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewCondition.toFormattedString}"/>
                                        </pre>
                                    </ui:define>
                                </o:tooltip>
                            </ice:column>
                            <ice:column
                                style="text-align: center">
                                <f:facet name="header">
                                    <ice:outputText value="Remove"/>
                                </f:facet>
                                <ice:panelGroup
                                    visible="#{true}"
                                    effect="#{privilegeBean.removeCellEffect}">
                                    <ice:commandLink
                                        actionListener="#{policyManageHandler.removeListener}">
                                        <f:attribute
                                            name="privilegeBean"
                                            value="#{privilegeBean}"/>
                                        <ice:graphicImage
                                            value="../image/remove-16.png"/>
                                    </ice:commandLink>
                                </ice:panelGroup>
                            </ice:column>
                        </ice:dataTable>
                    </div>
                </ui:define>
            </o:box>
        </div>
    </ui:define>
</ui:composition>
