<?xml version='1.0' encoding='UTF-8'?>
<ui:composition
    template="template/page.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:o="http://opensso.dev.java.net">

    <ui:define name="panel-title">
        <ice:outputText
            value="#{resources['policy-manage.panelTitle']}" />
    </ui:define>
    <ui:define name="panel-details">
        <ice:outputText
            value="#{resources['policy-manage.panelDetails']}" />
    </ui:define>
    <ui:define name="panel-body">
        <ui:include
            src="/admin/facelet/template/policy-manage-view-options-popup.xhtml"/>
        <div class="section-outer">
            <o:box>
                <ui:define name="body">
                    <div class="section-inner">
                        <span class="section-head">
                            <span class="section-title">
                                <ice:dataPaginator
                                    for="policyManageTable"
                                    rowsCountVar="rowsCount"
                                    displayedRowsCountVar="displayedRowsCountVar"
                                    firstRowIndexVar="firstRowIndex"
                                    lastRowIndexVar="lastRowIndex"
                                    pageCountVar="pageCount"
                                    pageIndexVar="pageIndex">
                                    <ice:outputFormat
                                        value="#{resources['policy-manage.tableTitle']}">
                                        <f:param value="#{firstRowIndex}" />
                                        <f:param value="#{lastRowIndex}" />
                                        <f:param value="#{rowsCount}" />
                                    </ice:outputFormat>
                                </ice:dataPaginator>
                            </span>
                            <span class="section-links">
                                <ice:panelGrid
                                    columns="3">
                                    <o:clink
                                        type="view-options"
                                        handler="#{policyManageHandler}"
                                        listenerMethod="viewOptionsListener"/>
                                    <ice:outputText
                                        style="font-weight: bold"
                                        value="|"/>
                                    <ice:panelGroup>
                                        <ice:graphicImage
                                            value="/admin/image/search.png"/>
                                        <ice:inputText
                                            styleClass="section-input"
                                            onkeyup="submitNow(this);"
                                            value="#{policyManageBean.searchFilter}"/>
                                    </ice:panelGroup>
                                </ice:panelGrid>
                            </span>
                        </span>
                        <div class="clear"></div>
                        <ui:include
                            src="/admin/facelet/template/policy-manage-filters.xhtml"/>
                        <ice:panelGroup
                            style="padding-top: 10px"
                            rendered="#{o:size(policyManageHandler.policyManageBean.privilegeBeans) == 0}">
                            <ice:outputText
                                value="No policies"/>
                        </ice:panelGroup>
                        <ice:panelGroup
                            rendered="#{o:size(policyManageHandler.policyManageBean.privilegeBeans) > 0}">
                            <ice:dataTable
                                id="policyManageTable"
                                var="privilegeBean"
                                rows="#{policyManageBean.policyManageTableBean.rows}"
                                styleClass="policy-manage"
                                value="#{policyManageHandler.policyManageBean.privilegeBeans}"
                                sortColumn="#{policyManageBean.policyManageTableBean.sortKey.column}"
                                sortAscending="#{policyManageBean.policyManageTableBean.sortKey.ascending}"
                                resizable="true">

                                <ice:column>
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="name"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Name"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        effect="#{privilegeBean.nameCellEffect}"
                                        visible="#{true}">
                                        <ice:commandLink
                                            styleClass="command-link"
                                            actionListener="#{policyManageHandler.editListener}"
                                            action="policy-edit">
                                            <f:attribute
                                                name="privilegeBean"
                                                value="#{privilegeBean}"/>
                                            <ice:outputText
                                                value="#{privilegeBean.name}"/>
                                        </ice:commandLink>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.descriptionColumnVisible}">
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="description"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Description"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        panelTooltip="descriptionTooltip"
                                        effect="#{privilegeBean.descriptionCellEffect}"
                                        visible="#{true}">
                                        <ice:outputText
                                            value="#{privilegeBean.description}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="descriptionTooltip"
                                        title="#{privilegeBean.name}: description">
                                        <ui:define name="body">
                                            <ice:outputText
                                                value="#{privilegeBean.description}"/>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.modifierColumnVisible}">
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="modifier"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Modified By"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.modifierCellEffect}">
                                        <ice:outputText
                                            value="#{privilegeBean.modifier}"/>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.authorColumnVisible}">
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="author"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Author"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.authorCellEffect}">
                                        <ice:outputText
                                            value="#{privilegeBean.author}"/>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.modifiedColumnVisible}">
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="modified"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Modified"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.modifiedCellEffect}">
                                        <ice:outputText
                                            value="#{privilegeBean.modified}">
                                            <f:convertDateTime
                                                dateStyle="short"
                                                timeZone="#{timeZoneBean.timeZone.ID}"
                                                type="both" />
                                        </ice:outputText>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.birthColumnVisible}">
                                    <f:facet name="header">
                                        <ice:commandSortHeader
                                            columnName="birth"
                                            actionListener="#{policyManageHandler.sortTableListener}">
                                            <ice:outputText
                                                value="Created"/>
                                        </ice:commandSortHeader>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.birthCellEffect}">
                                        <ice:outputText
                                            value="#{privilegeBean.birth}">
                                            <f:convertDateTime
                                                dateStyle="short"
                                                timeZone="#{timeZoneBean.timeZone.ID}"
                                                type="both" />
                                        </ice:outputText>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.resourcesColumnVisible}">
                                    <f:facet name="header">
                                        <ice:outputText
                                            value="Resources"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.resourcesCellEffect}"
                                        panelTooltip="resourcesTooltip">
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.resourcesToString}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="resourcesTooltip"
                                        title="#{privilegeBean.name}: resources (#{o:size(privilegeBean.viewEntitlement.resources)})">
                                        <ui:define name="body">
                                            <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.resourcesToFormattedString}"/>
                                            </pre>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.exceptionsColumnVisible}">
                                    <f:facet name="header">
                                        <ice:outputText
                                            value="Exceptions"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.exceptionsCellEffect}"
                                        panelTooltip="exceptionsTooltip">
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.exceptionsToString}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="exceptionsTooltip"
                                        title="#{privilegeBean.name}: exceptions (#{o:size(privilegeBean.viewEntitlement.exceptions)})">
                                        <ui:define name="body">
                                            <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.exceptionsToFormattedString}"/>
                                            </pre>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.subjectColumnVisible}">
                                    <f:facet name="header">
                                        <ice:outputText
                                            value="Subjects"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.subjectCellEffect}"
                                        panelTooltip="subjectTooltip">
                                        <ice:outputText
                                            value="#{privilegeBean.viewSubject.toString}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="subjectTooltip"
                                        title="#{privilegeBean.name}: subjects (#{privilegeBean.viewSubject.size})">
                                        <ui:define name="body">
                                            <pre>
                                        <ice:outputText
                                        value="#{privilegeBean.viewSubject.toFormattedString}"/>
                                            </pre>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.actionColumnVisible}">
                                    <f:facet name="header">
                                        <ice:outputText
                                            value="Actions"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.actionCellEffect}"
                                        panelTooltip="actionTooltip">
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.booleanActionsBean.actionsToString}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="actionTooltip"
                                        title="#{privilegeBean.name}: actions (#{o:size(privilegeBean.viewEntitlement.booleanActionsBean.actions)})">
                                        <ui:define name="body">
                                            <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewEntitlement.booleanActionsBean.actionsToFormattedString}"/>
                                            </pre>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.conditionColumnVisible}">
                                    <f:facet name="header">
                                        <ice:outputText
                                            value="Conditions"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.conditionCellEffect}"
                                        panelTooltip="conditionTooltip">
                                        <ice:outputText
                                            value="#{privilegeBean.viewCondition.toString}"/>
                                    </ice:panelGroup>
                                    <o:tooltip
                                        tooltipId="conditionTooltip"
                                        title="#{privilegeBean.name}: conditions (#{privilegeBean.viewCondition.size})">
                                        <ui:define name="body">
                                            <pre>
                                        <ice:outputText
                                            value="#{privilegeBean.viewCondition.toFormattedString}"/>
                                            </pre>
                                        </ui:define>
                                    </o:tooltip>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.exportColumnVisible}"
                                    style="text-align: center">
                                    <f:facet name="header">
                                        <ice:outputText value="Export"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.exportCellEffect}">
                                        <ice:outputLink
                                            value="../pxml?name=#{privilegeBean.name}">
                                            <ice:graphicImage
                                                value="../image/xml.png"/>
                                        </ice:outputLink>
                                    </ice:panelGroup>
                                </ice:column>
                                <ice:column
                                    rendered="#{policyManageBean.policyManageTableBean.removeColumnVisible}"
                                    style="text-align: center">
                                    <f:facet name="header">
                                        <ice:outputText value="Remove"/>
                                    </f:facet>
                                    <ice:panelGroup
                                        visible="#{true}"
                                        effect="#{privilegeBean.removeCellEffect}">
                                        <ice:commandLink
                                            actionListener="#{policyManageHandler.removeListener}">
                                            <f:attribute
                                                name="privilegeBean"
                                                value="#{privilegeBean}"/>
                                            <ice:graphicImage
                                                value="../image/remove-16.png"/>
                                        </ice:commandLink>
                                    </ice:panelGroup>
                                </ice:column>
                            </ice:dataTable>
                            <center>
                                <ice:panelGrid
                                    columns="1" >
                                    <ice:dataPaginator
                                        for="policyManageTable"
                                        rowsCountVar="rowsCount"
                                        displayedRowsCountVar="displayedRowsCountVar"
                                        rendered="#{o:size(policyManageBean.privilegeBeans) > policyManageBean.policyManageTableBean.rows}"
                                        fastStep="1"
                                        pageCountVar="pageCount"
                                        pageIndexVar="pageIndex"
                                        paginatorMaxPages="9"
                                        paginator="true">
                                        <f:facet name="first">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-first.gif" style="border:none;"/>
                                        </f:facet>
                                        <f:facet name="last">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-last.gif" style="border:none;" />
                                        </f:facet>
                                        <f:facet name="previous">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-previous.gif" style="border:none;" />
                                        </f:facet>
                                        <f:facet name="next">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-next.gif" style="border:none;" />
                                        </f:facet>
                                        <f:facet name="fastforward">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-ff.gif" style="border:none;" />
                                        </f:facet>
                                        <f:facet name="fastrewind">
                                            <ice:graphicImage
                                                url="/xmlhttp/css/rime/css-images/arrow-fr.gif" style="border:none;" />
                                        </f:facet>
                                    </ice:dataPaginator>
                                </ice:panelGrid>
                            </center>
                        </ice:panelGroup>
                    </div>
                </ui:define>
            </o:box>
        </div>
    </ui:define>
</ui:composition>
