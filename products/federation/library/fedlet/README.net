------------------------------------------------------------------------------
README file for the .NET Fedlet
------------------------------------------------------------------------------
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
  
Copyright (c) 2009 Sun Microsystems Inc. All Rights Reserved
  
The contents of this file are subject to the terms
of the Common Development and Distribution License
(the License). You may not use this file except in
compliance with the License.

You can obtain a copy of the License at
https://opensso.dev.java.net/public/CDDLv1.0.html or
opensso/legal/CDDLv1.0.txt
See the License for the specific language governing
permission and limitations under the License.

When distributing Covered Code, include this CDDL
Header Notice in each file and include the License file
at opensso/legal/CDDLv1.0.txt.
If applicable, add the following below the CDDL Header,
with the fields enclosed by brackets [] replaced by
your own identifying information:
"Portions Copyrighted [year] [name of copyright owner]"

$Id: README.net,v 1.1 2009-05-01 15:19:54 ggennaro Exp $

%% Contents:
    %% 1. Contents of this directory 
    %% 2. What is currently supported
    %% 3. How to configure and deploy the Fedlet for .NET
    %% 4. How to use the Sample Application to test your deployment
    %% 5. How to integrate with existing application after Single Sign-on


%% 1. Contents of this directory 
   This README file provides information on the Fedlet for .NET without a 
   pre-configured Identity Provider (IDP) and Fedlet (SP) metadata.  Manual
   steps are needed to set up the Fedlet for .NET to work with a remote IDP.
 
   Fedlet-unconfigured.zip
     |- asp.net
         |                           
         |- bin                    
         |   |- Fedlet.dll        The DLL to deploy in the bin/ folder of
         |                        your application.
         |                        
         |- conf                  Folder containing template metadata files 
         |                        for use by the Fedlet for .NET applications.
         |                             
         |- SampleApp             The sample application to demonstrate
         |                        connectivity between the remote IDP and
         |                        the Fedlet (SP).
         |                             
         |- readme.txt            This README file. The file shows how to
                                  install, configure, and use the Fedlet.
                                  

%% 2. What is currently supported
   The Fedlet.dll currently supports IDP initiated SSO with POST binding. This
   is accomplished by providing ASP.NET developers an API to retrieve an
   AuthnResponse from their IDP.  Details are described in Section 5 below.

%% 3. How to configure and deploy the Fedlet for .NET
   The Fedlet.dll contains all the necessary bits for the Fedlet provide 
   ASP.NET developers an interface to a light-weight SAMLv2 Service Provider
   API. These developers can use the API to initiate single sign on to an 
   Identity Service Provider and receive an HTTP-POST in their application to 
   retrieve useful information provided in the AuthnResponse.

   Steps to configure and deploy the Fedlet for .NET:
      a) Extract the asp.net/ folder within the Fedlet-unconfigured.zip to a 
         temporary directory.
      b) Within the conf/ folder, edit the template files by changing
         the following tags:

    FEDLET_COT       : Replace with the name of your circle of trust.
    FEDLET_ENTITY_ID : Replace with the name of the entity id for your Fedlet.
    FEDLET_URL       : Replace with the url of the Fedlet.
                       http://sp.example.com/SampleApp/fedletapplication.aspx
    IDP_ENTITY_ID    : Replace with the name of the entity id of the remote 
                       Identity Provider.

      c) Copy the edited files above to your application's App_Data/ folder.
      d) Obtain the standard metadata XML file from your IDP, name it idp.xml,
         and place in your application's App_Data/ folder.  If your IDP is
         an OpenSSO deployment, this can be exported by accessing the export
         URL.  For example:
         http://idp.example.com:8080/opensso/saml2/jsp/exportmetadata.jsp
      e) Provide the Fedlet metadata XML file "sp.xml" to your IDP.  The
         metadata must be imported to the IDP machine and must be associated
         with the same Circle of Trust as the IDP. If your IDP is an OpenSSO
         deployment, use the Register Remote Service Provider workflow
         available from the Common Tasks page to import your Fedlet's 
         metadata.
      f) Configuration is now complete.
      g) Copy the Fedlet.dll from the bin/ folder to your application's bin/
         folder.

   By having the Fedlet artifacts deployed specifically in the App_Data/ and
   bin/ folder of your hosted application, multiple instances of the Fedlet with
   its own configuration can be co-deployed in the same Internet Information
   Server (IIS).
      
%% 4. How to use the Sample Application to test your deployment
   The Sample Application could be used to test your deployment of the Fedlet
   for your .NET applications.

   Steps to deploy the Sample Application:   
      a) Install the Sample Application on your Service Provider
          i) Navigate to the asp.net/ folder extracted from the 
             Fedlet-unconfigured.zip as described in Section 3 above.
         ii) Copy over the metadata files edited in Section 3 above and place
             into the SampleApp/App_Data folder. 
             - The following files should have been copied over:
               idp.xml, idp-extended.xml, sp.xml, sp-extended.xml, fedlet.cot
             - The files in the existing sample application were configured 
               for idp.example.com and sp.example.com and are expected to be 
               replaced for your installation.
        iii) Within Internet Information Server, create a virtual directory 
             with the SampleApp/ folder found within the unzipped folder.
             - IIS 6 has Add Virtual Directory.  Be sure to have Read and 
               Script permissions set for the application.
             - IIS 7 has Add Application with no additional options required 
               to be altered.
      b) Try out the Sample Application. 
           i) Open the SampleApp in your browser. For example:
              http://sp.example.com/SampleApp
          ii) Click the link to perform the IDP initiated SSO.
         iii) Enter in your credentials (such as demo / changeit ).
          iv) After the form submission, you should be at the 
              fedletapplication.aspx page with access to the AuthnResponse 
              information.

%% 5. How to integrate with existing application after Single Sign-on
   The Sample Application described above demonstrates possible usage by 
   ASP.NET developers. Once the application has the necessary artifacts 
   installed, a specific URI is required to receive the HTTP-POST containing 
   the SAMLv2 response after successful authentication by the IDP.  The 
   following example shows how the developer would retrieve this information:
   
       AuthnResponse authnResponse = null; 
       try 
       { 
           ServiceProviderUtility spu = new ServiceProviderUtility(Context); 
           authnResponse = spu.GetAuthnResponse(Request); 
       } 
       catch (Saml2Exception se) 
       { 
           // invalid AuthnResponse received 
       } 
       catch (ServiceProviderUtilityException spue) 
       { 
           // issues with deployment (reading metadata) 
       } 
   
   If a SAML response was received the authnResponse object will be populated
   with the assertion information.  The sample application demonstrates how to
   retreive attributes and sujbect information from this object.


