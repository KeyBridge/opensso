------------------------------------------------------------------------------
README file for Open Federation Library
------------------------------------------------------------------------------
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
  
Copyright (c) 2008 Sun Microsystems Inc. All Rights Reserved
  
The contents of this file are subject to the terms
of the Common Development and Distribution License
(the License). You may not use this file except in
compliance with the License.

You can obtain a copy of the License at
https://opensso.dev.java.net/public/CDDLv1.0.html or
opensso/legal/CDDLv1.0.txt
See the License for the specific language governing
permission and limitations under the License.

When distributing Covered Code, include this CDDL
Header Notice in each file and include the License file
at opensso/legal/CDDLv1.0.txt.
If applicable, add the following below the CDDL Header,
with the fields enclosed by brackets [] replaced by
your own identifying information:
"Portions Copyrighted [year] [name of copyright owner]"

$Id: README,v 1.6 2008-06-25 05:46:15 qcheng Exp $



%% Contents:
    %% 1. Contents of this directory 
    %% 2. How to use fedlet.war for demo.
    %% 3. How to embed Fedlet into existing application
    %% 4. How to integrate with existing application after Single Sign-on 


%% 1. Contents of this directory 
   This README file provides information on Fedlet ZIP file with pre-configured
   IDP and Fedlet (SP) metadata.
 
   Fedlet.zip 
     |
     |- fedlet.war        Fedlet WAR file. This is a ready-to-deploy WAR 
     |                    to show the Fedlet features.
     |
     |- README            This README file. The file shows how to use Fedlet.


%% 2. How to use fedlet.war for demo 
     The fedlet.war contains all necessay bits for Fedlet to acting as a 
     light-weighted SAMLv2 Service provider. It also provides convenient ways 
     to setup and validate Fedlet deployment. 

     After deploying fedlet.war into your web container, try access the 
     Fedlet(SP) index.jsp page to start Fedlet setup, e.g.
         <SP_PROTOCOL>://<SP_HOST>:<SP_PORT>/<SP_DEPLOY_URI>/index.jsp

     If this is the first time the page is accessed, it will show that the 
     Fedlet home directory is not configured yet, and a link will be provided 
     for you to create the configuration automatically. After done, you will 
     be shown links to start Fedlet(SP) and IDP initiated Single Sing-on. 
     Click the link, you will be redirected to IDP for login, then Single 
     Sign-on to Fedlet(SP). Upon successful completion, a Fedlet(SP) side JSP 
     will be presented to show the SSO Response, Assertion and 
     AttributeStatement if any.

     
%% 3. How to embed Fedlet into your existing application WAR
  a) Extract the fedlet.war into a temporal directory. 
  b) Copy files inside "conf" directory to a sub directory named "fedlet" 
     under your web container running user's home directory (pointed by
     JVM property "user.home"). For example, assume running user's home 
     directory is "/home/webservd":
         % mkdir /home/webservd/fedlet 
         % cd conf
         % cp * /home/webservd/fedlet 
     The "fedlet" subdirectory under the web container running user's home 
     is the default location for Fedlet to read its metadata, COT and 
     configuration properties. To change this default directory, set the 
     value of a JVM run-time property "com.sun.identity.fedlet.home" to the 
     desired location.  For example:  
         -Dcom.sun.identity.fedlet.home=/export/fedlet/conf 
     this will tell Fedlet to read metadata/COT/configuration files from 
     "/export/fedlet/conf" directory instead.
  c) Copy all other files to your application WAR staging directory, overlay 
     them with your existing application WAR structure.
     Optionally you could remove index.jsp and "conf" directory from the 
     temporal directory created in step a) before copying. 
  d) Create the application WAR and redeploy in your web container. 


%% 4. How to integrate with existing application after Single Sign-on
     There is a sample Fedlet application, fedletSampleApp.jsp, bundled 
     with fedlet.war. The fedletSampleApp.jsp first invokes a util method 
     to complete SAMLv2 protocol processing. A map containing various data, 
     including Response/Assertion/Attributes, is returned to caller for further
     processing. The fedletSampleApp.jsp also provides some sample code on 
     how to retrieve data from the returned map. 
     You could either modify fedletSampleApp.jsp to add your application
     specific logic or replace fedletSampleApp.jsp with your own servlet/jsp.
     To replace fedletSampleApp.jsp with new servlet/JSP:
     1. Modify web.xml to set servlet and servlet-mapping for your new servlet
        or JSP. You must map your new servlet/JSP to the url-pattern 
        "/fedletapplication" since it is the URI set in the Fedlet metadata 
        (the assertion consumer URL). For example:
            <servlet>
                <servlet-name>yourapplication</servlet-name>
                <jsp-file>/Your-Application.jsp</jsp-file>
            </servlet>
            <servlet-mapping>
                <servlet-name>yourapplication</servlet-name>
                <url-pattern>/fedletapplication</url-pattern>
            </servlet-mapping> 
     2. Copy following code from fedletSampleApp.jsp to your
        application processing code with proper import statement:
Map map;
try {
    // invoke the Fedlet processing logic. this will do all the
    // necessary processing conforming to SAMLv2 specifications,
    // such as XML signature validation, Audience and Recipient
    // validation etc.
    map = SPACSUtils.processResponseForFedlet(request, response);
} catch (SAML2Exception sme) {
    response.sendError(response.SC_INTERNAL_SERVER_ERROR, sme.getMessage());
    return;
} catch (IOException ioe) {
    response.sendError(response.SC_INTERNAL_SERVER_ERROR, ioe.getMessage());
    return;
} catch (SessionException se) {
    response.sendError(response.SC_INTERNAL_SERVER_ERROR, se.getMessage());
    return;
} catch (ServletException se) {
    response.sendError(response.SC_BAD_REQUEST, se.getMessage());
    return;
}
        After obtaining the returned "map" object, you could follow the sample
        code to retrieve data needed for your business logics.

