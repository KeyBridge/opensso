<html>
<body>
<b>Secure Attributes Exchange (SAE) : Sample </b>
<br><br>
This sample demonstrates usage of SAE feature.
<br>
<br> <b>Actors :</b>
<br> (1) %lt;OpenSSO>-IDP : OpenSSO setup as samlv2 IDP.
<br> (2) %lt;OpenSSO>-SP : OpenSSO setup as samlv2 SP.
<br> (3) samplesaml2cot : Circle of Trust comprising %lt;OpenSSO>-IDP and %lt;OpenSSO>-SP.
<br> (4) IDP-App : A web application hosted on IDP end (saeIDPApp.jsp). 
<br> (5) SP-App : A web application hosted on SP end (saeSPApp.jsp).
<br>
<br>
<br><a><b>IDP-App</b> --- sae --- <b>%lt;OpenSSO>-IDP</b> -|- samlv2 -|- <b>%lt;OpenSSO>-SP</b> --- sae --- <b>SP-App</b></a>
<br>
<br> The detailed steps listed below will  help you learn the following aspects of SAE:
<br>  - Setting up trust relationship between IDP-App and %lt;OpenSSO>-IDP.
<br>  - Setting up trust relationship between SP-App and %lt;OpenSSO>-SP.
<br>  - Passing user Authentication information from IDP-App to %lt;OpenSSO>-IDP.
<br>  - Passing user attribute information from IDP-App to %lt;OpenSSO>-IDP.
<br>  - Using %lt;OpenSSO>-IDP as a gateway to access SP-App.
<br>  - Consuming authentication and attribute data in SP-App.
<br>
<br><b>Detailed Steps</b>
<br> <i>Step 1 </i>: Perform initial install & setup as in SAMLv2 <a href="../index.html">sample main page</a> <b>Setup</b> section.
              In effect we are creating two domains that will communicate
              over SAMLv2.
<br>
<br> <i>Step 2</i> : Establish trust between IDP-App and IDP-%lt;OpenSSO>.
<br><b>Symmetric Method :</b> Choose a shared secret to be used between IDP-App and %lt;OpenSSO>-IDP. 
<br>(2a) saeIDPApp.jsp is factored as a form that will prompt for these values, but you may choose to edit it to : (i) initialize <i>cryptotype</i> variable to "symmetric" (ii) initialize the <i>secret</i> variable to shared secret string.[ Note - in a real deployment the app should store this secret on disk by encrypting it in a file and keeping the file safe. ] and (ii) initialize the <i>idpAppName</i> variable to a string that uniquely identifies this IDP-App  (iii) initialize the <i>saeServiceUrl</i> parameter to : &lt;%lt;OpenSSO>-IDP deployment url&gt;/idpsaehandler
<br>(2b) Export %lt;OpenSSO>-IDP's metadata; Edit idpExtended Metadata file to add the following information : IDP-App name, type and shared secret; Re-load metadata on IDP end.
<br>(2c) Export %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-IDP end; Edit spExtended metadata file to add the following information: saml attributes to be sent as part of the saml assertion to %lt;OpenSSO>-SP, and %lt;OpenSSO>-SP SAE handling url; Re-load %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-IDP end. Restart web container if needed.
<br><b>Asymmetric Method :</b>Obtain a private-public key pair. Store the key pair ia secure keystore. Add the publickey to %lt;OpenSSO>-SP's keystore (see saml2 docs).
<br>(2a)saeIDPApp.jsp is factored as a form that will prompt for these values, but you may choose to edit it to : (i) initialize <i>cryptotype</i> variable to "asymmetric" (ii) initialize the <i>secret</i> variable to private key alias string.[ Note - in a real deployment the app should store private key in a secure keystor. ] and (ii) initialize the <i>idpAppName</i> variable to a string that uniquely identifies this IDP-App  (iii) initialize the <i>saeServiceUrl</i> parameter to : &lt;%lt;OpenSSO>-IDP deployment url&gt;/idpsaehandler
<br>(2b) Export %lt;OpenSSO>-IDP's metadata. Return to SAMLv2 sample steps: edit idpExtended Metadata file to add the following information : IDP-App name, encryption type and pubkeyalias; Re-load %lt;OpenSSO>-IDP metadata on IDP end.
<br>(2c) Export %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-IDP end; Edit spExtended metadata file to add the following information: saml attributes to be sent as part of the saml assertion to %lt;OpenSSO>-SP, and %lt;OpenSSO>-SP SAE handling url; Re-load %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-IDP end. Restart web container if needed.

<br><br> <i>Step 3</i> : Establish trust between SP-App and %lt;OpenSSO>-SP.
<br><b>Symmetric Method:</b> Choose a shared secret to be used between SP-App and %lt;OpenSSO>-SP. 
<br>(3a) Edit saeSPApp.jsp to :(i) initialize <i>cryptotype</i> variable to "symmetric" (ii) initialize the <i>secret</i> variable to the shared secret string.[ Note - in a real deployment the app should store this secret on disk by encrypting it in a file and keeping the file safe. ]. (iii) determine the URL representing this SP-App.
<br>(3b) Export %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-SP end; Edit spExtended Metadata file to add the following information : SP-App URL, encryption type, shared secret, auto-federation, saml attributes to be sent as part of the saml assertion, and SAE logout url if needed; Re-load metadata on SP. Restart web container if needed.
<br><b>Asymmetric Method:</b> Obtain a private-public key pair for setting up %lt;OpenSSO>-SP.
<br>(3a) Setup the public/private key in a local keystore.
<br>(3b) Edit saeSPApp.jsp to :(i) initialize <i>cryptotype</i> variable to "asymmetric" (ii) initialize the <i>secret</i> variable to the OpenSSO's public key alias string.
 (iii) determine the URL representing this SP-App. (iv) Setup rest of init params.
<br>(3c) Export %lt;OpenSSO>-SP's metadata on %lt;OpenSSO>-SP end; Edit spExtended metadata file to add the following information: SP-App URL, encryption type, pubkeyalias, auto-federation, saml attributes to be sent as part of the saml assertion, and SAE logout url if needed; Re-load %lt;OpenSSO>-SP metadata on SP end. Restart web container if needed.
<br>
<br> <i>Step 4</i> : Deploy saeAppIDP.jsp and saeAppSP.jsp on the respective domains. For simplicity you may choose to use the predeployed jsps on respective OpenSSO instances. But it is recommended you install them in their own web containers. 
<br>
<br> <i>Step 5</i> : Execute the sample.
<br>  Start a browser and access <IDP-App deployment url>/saeIDPApp.jsp
<br>  Fill up the form with the values you want communicated to %lt;OpenSSO>-IDP :
<br>    logged in username, attributes (mail, branch).
<br>  Clicking on "Send Attributes" will securely invoke SP-App.
<br>
<br> <b>Troubleshooting</b>
<br> OpenSSO Debug files : SAE and samlv2 on IDP and SP ends.
<br> dumpcookies.jsp can be deployed on SP/IDP ends to view http headers and OpenSSO session.
<br> --
</body>
</html>
