<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<!--
   The contents of this file are subject to the terms
   of the Common Development and Distribution License
   (the License). You may not use this file except in
   compliance with the License.
                                                                                                                                  
   You can obtain a copy of the License at
   https://opensso.dev.java.net/public/CDDLv1.0.html or
   opensso/legal/CDDLv1.0.txt
   See the License for the specific language governing
   permission and limitations under the License.
                                                                                                                                  
   When distributing Covered Code, include this CDDL
   Header Notice in each file and include the License file
   at opensso/legal/CDDLv1.0.txt.
   If applicable, add the following below the CDDL Header,
   with the fields enclosed by brackets [] replaced by
   your own identifying information:
   "Portions Copyrighted [year] [name of copyright owner]"

   $Id: index.html,v 1.4 2007-11-20 21:33:04 mrudul_uchil Exp $

   Copyright 2007 Sun Microsystems Inc. All Rights Reserved
-->
  <title>Security Token Service Client Sample</title>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css"
 href="../com_sun_web_ui/css/css_ns6up.css">
</head>
<body class="DefBdy">
<div class="MstDiv">
<table class="MstTblTop" title="" border="0" cellpadding="0"
 cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td nowrap="nowrap">&nbsp;</td>
      <td nowrap="nowrap">&nbsp;</td>
    </tr>
  </tbody>
</table>
<table class="MstTblBot" title="" border="0" cellpadding="0"
 cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td class="MstTdTtl" width="99%">
      <div class="MstDivTtl"><img name="ProdName"
 src="../console/images/PrimaryProductName.png" alt=""></div>
      </td>
      <td class="MstTdLogo" width="1%"><img
 name="RMRealm.mhCommon.BrandLogo"
 src="../com_sun_web_ui/images/other/javalogo.gif" alt="Java(TM) Logo"
 border="0" height="55" width="31"></td>
    </tr>
  </tbody>
</table>
<table class="MstTblEnd" border="0" cellpadding="0" cellspacing="0"
 width="100%">
  <tbody>
    <tr>
      <td><img name="RMRealm.mhCommon.EndorserLogo"
 src="../com_sun_web_ui/images/masthead/masthead-sunname.gif"
 alt="Sun(TM) Microsystems, Inc." align="right" border="0" height="10"
 width="108"></td>
    </tr>
  </tbody>
</table>
</div>
<div class="SkpMedGry1"><a name="SkipAnchor2089" id="SkipAnchor2089"></a></div>
<div class="SkpMedGry1"><a href="#SkipAnchor4928"><img
 src="../com_sun_web_ui/images/other/dot.gif"
 alt="Jump Over Tab Navigation Area. Current Selection is: Access Control"
 border="0" height="1" width="1"></a></div>
<table border="0" cellpadding="10" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td>
      <p>&nbsp;</p>
      <a href="../index.html">Client Samples Main Page</a>
      <p>&nbsp;</p>
      <h3>Introduction</h3>
      <p> This sample demonstrates the usage of Security Token Service
Client API for obtaining security tokens from a Security Token Service
hosted on Federated Access Manager. <br>
There are three parties involved in this sample: <br>
* Web Services Client (WSC) <br>
* Web Services Provider (WSP) <br>
* Security Token Service (STS)<br>
      </p>
      <p>The security token service issues security tokens for web
services clients so that web services clients could present it to the
web services providers for authentication purposes.The Federated
Access Manager Security Token Service currently issues
SAML1 security tokens and SAML2 security tokens for web services
clients. In order to generate SAML Tokens, web services client must
need to authenticate against
using it's X509 Certificate. <br>
      </p>
      <h3>Setup</h3>
This sample needs configuration of Security Token Service hosted on
Federated Access Manager , Security Token Service Client
Configuration, Web Services Client Configuration and Web Services
Provider Configuration. The web services security in Federated Access
Manager requires a JKS KeyStore. Creating a JKS
Keystore is describes in SAML samples and this samples assumes that you
have created the keystore and
the corresponding keypass, storepass files and updated their locations
in server's AMConfig.properties file. You could use different
private keys for STS, WSC and WSP.<br>
      <br>
      <span style="font-style: italic;">[<span
 style="color: rgb(204, 0, 0);">Note</span> : Temporary action - There
is client AMConfig.properties file bundled with this web application
(under web application's root directory). You need to tag swap values
of properties which are dynamic and then place this updated
AMConfig.properties file under web application's WEB-INF/classes
directory. Then restart the container.]</span><br>
      <br>
      <span style="font-weight: bold;">Before you setup STS, deploy the
stockquote web service client and stock quote web service provider as
mentioned in the README file of web services agent samples. This is
must before running this sample. Also follow the steps in README to
configure Glassfish for web services security using FAM JSR196 agents.</span><br
 style="font-weight: bold;">
      <br>
STS Setup:<br>
      <br>
Currently the FAM STS requires&nbsp; keystore to be configured in WSDL
also. By default, the opensso.war does not have this configured as it
would
not know the location of keystore. So,this would require re-deploy of
the FAM war on glassfish if you have
already deployed FAM. <br>
      <br>
&nbsp;&nbsp; 1.&nbsp; Unwar the opensso.war <br>
&nbsp;&nbsp; 2.&nbsp; Open the famsts.wsdl from WEB-INF/wsdl directory<br>
&nbsp;&nbsp; 3.&nbsp; Check for TrustStore and KeyStore XML elements,
uncomment these elements.<br>
&nbsp;&nbsp; 4.&nbsp; Modify the kestore location, passwords, and
recreate the war file using jar cvf&nbsp; opensso.war<br>
&nbsp;&nbsp; 5.&nbsp; Redeploy the war file and make sure that
FAM&nbsp; STS WSDL is accessible.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;/&lt;opensso_deploy_uri&gt;/sts?wsdl<br>
      <br>
Agent configurations using "famadm" cli.<br>
      <ol>
        <li>Pick up the opensso.zip from the build directory, and unzip
it into a temp directory. There should be a file famAdminTools.zip.
Create a directory for CLI and unzip the famAdminTools.zip into the
directory.</li>
        <li>In the CLI directory, do "setup -p &lt;FAM config
directory&gt;".&nbsp; The &lt;FAM config directory&gt; is the config
directory you specified while configuring the opensso server.</li>
        <li>The setup will create a directory called opensso. cd to
opensso/bin to find admin tool "famadm".</li>
        <li>Create Security Token Service agent of type "STSAgent"
using "famadm" cli :
          <div style="margin-left: 40px;">famadm create-agent -b
SecurityTokenService -t STSAgent -u amadmin -f &lt;amadmin user
password file&gt; -D STSAgentConfiguration.properties</div>
Create STSAgentConfiguration.properties like :<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; userpassword=&lt;agent password&gt;<br>
&nbsp;&nbsp;&nbsp; sunIdentityServerDeviceStatus=Active<br>
&nbsp;&nbsp;&nbsp; SecurityMech=urn:sun:wss:security:null:X509Token<br>
&nbsp;&nbsp;&nbsp; isRequestSign=true<br>
&nbsp;&nbsp;&nbsp;
STSEndpoint=&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;/&lt;opensso_deploy_uri&gt;/sts<br>
&nbsp;&nbsp;&nbsp;
STSMexEndpoint=&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;/&lt;opensso_deploy_uri&gt;/sts/mex
&nbsp;&nbsp; <br>
        </li>
        <li>Create
StockService Web Service agent of type "WSCAgent" using "famadm" cli :
          <div style="margin-left: 40px;">famadm create-agent -b
StockService -t WSCAgent -u amadmin -f &lt;amadmin user password
file&gt; -D WSCAgentConfiguration.properties</div>
Create WSCAgentConfiguration.properties like :<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; userpassword=&lt;agent password&gt;<br>
&nbsp;&nbsp;&nbsp; sunIdentityServerDeviceStatus=Active<br>
&nbsp;&nbsp;&nbsp; SecurityMech=urn:sun:wss:sts:security<br>
&nbsp;&nbsp;&nbsp; STS=SecurityTokenService<br>
&nbsp;&nbsp;&nbsp; isRequestSign=true<br>
&nbsp;&nbsp;&nbsp;
WSPEndpoint=&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;/StockService/StockService<br>
&nbsp;&nbsp;&nbsp; <br>
        </li>
        <li>Create
StockService Web Service Provider agent of type "WSPAgent" using
"famadm" cli :
          <div style="margin-left: 40px;">famadm create-agent -b wsp -t
WSPAgent -u amadmin -f &lt;amadmin user password file&gt; -D
WSPAgentConfiguration.properties</div>
        </li>
      </ol>
      <div style="margin-left: 40px;">Create
WSPAgentConfiguration.properties like :<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; userpassword=&lt;agent password&gt;<br>
&nbsp;&nbsp;&nbsp; sunIdentityServerDeviceStatus=Active<br>
&nbsp;&nbsp;&nbsp; SecurityMech=urn:sun:wss:security:null:SAMLToken-SV<br>
&nbsp;&nbsp;&nbsp; SecurityMech=urn:sun:wss:security:null:SAMLToken-HK<br>
&nbsp;&nbsp;&nbsp; isRequestSign=true<br>
&nbsp;&nbsp; <br>
      </div>
      <h3>How to Run:</h3>
1. Deploy the fam client samples in glassfish and make sure that you
have configured as in readme index.html file<br>
2. Access http://&lt;host&gt;:&lt;port&gt;/fam-client/sts/sts-client.jsp<br>
3. Enter web service name as "StockService" and click "GetToken"<br>
4. If successful, this will display SAML Assertion obtained from FAM
Security Token Service.<br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
</body>
</html>
