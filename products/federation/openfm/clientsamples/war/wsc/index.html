<!--
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
  
   Copyright (c) 2007 Sun Microsystems Inc. All Rights Reserved
  
   The contents of this file are subject to the terms
   of the Common Development and Distribution License
   (the License). You may not use this file except in
   compliance with the License.
                                                                                                                                  
   You can obtain a copy of the License at
   https://opensso.dev.java.net/public/CDDLv1.0.html or
   opensso/legal/CDDLv1.0.txt
   See the License for the specific language governing
   permission and limitations under the License.
                                                                                                                                  
   When distributing Covered Code, include this CDDL
   Header Notice in each file and include the License file
   at opensso/legal/CDDLv1.0.txt.
   If applicable, add the following below the CDDL Header,
   with the fields enclosed by brackets [] replaced by
   your own identifying information:
   "Portions Copyrighted [year] [name of copyright owner]"

   $Id: index.html,v 1.5 2008-08-15 01:05:33 veiming Exp $

-->
<html>
<head>
<title>WSC Sample</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="stylesheet" type="text/css" href="../com_sun_web_ui/css/css_ns6up.css" />
</head>
<body class="DefBdy">
                                                                                
<div class="MstDiv"><table width="100%" border="0" cellpadding="0" cellspacing="0" class="MstTblTop" title="">
<tbody><tr>
<td nowrap="nowrap">&nbsp;</td>
<td nowrap="nowrap">&nbsp;</td>
</tr></tbody></table>
                                                                                
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="MstTblBot" title="">
<tbody><tr>
<td class="MstTdTtl" width="99%">
<div class="MstDivTtl"><img name="ProdName" src="../console/images/PrimaryProductName.png" alt="" /></div></td><td class="MstTdLogo" width="1%"><img name="RMRealm.mhCommon.BrandLogo" src="../com_sun_web_ui/images/other/javalogo.gif" alt="Java(TM) Logo" border="0" height="55" width="31" /></td></tr></tbody></table>
<table class="MstTblEnd" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><img name="RMRealm.mhCommon.EndorserLogo" src="../com_sun_web_ui/images/masthead/masthead-sunname.gif" alt="Sun(TM) Microsystems, Inc." align="right" border="0" height="10" width="108" /></td></tr></tbody></table></div><div class="SkpMedGry1"><a name="SkipAnchor2089" id="SkipAnchor2089"></a></div>
<div class="SkpMedGry1"><a href="#SkipAnchor4928"><img src="../com_sun_web_ui/images/other/dot.gif" alt="Jump Over Tab Navigation Area. Current Selection is: Access Control" border="0" height="1" width="1" /></a></div>
                                                                                
<table border="0" cellpadding="10" cellspacing="0" width="100%">
<tr><td>
<p>&nbsp;</p>
&lt; <a href="../index.html">Client Sample Main Page</a>
<p>&nbsp;</p>

<h3>Introduction</h3>
<p>
    This explains how to deploy and run the WSC sample to query and modify
    Liberty Discovery Service and ID-SIS Personal Profile Service.
<br>    
    There are five parties involved in this sample:
<br>
    * Liberty Service Provider (SP)
<br>
    * Liberty Identity Provider (IDP)
<br>
    * Web Service Consumer (WSC)
<br>
    * Liberty Discovery Service (DS)
<br>
    * Liberty ID-SIS Personal Profile Service (ID-SIS-PP)
</p>
<p>
    Here is the general flow of the sample :
<br>    
    1. Complete the Liberty Single-Sign-On Process, obtain Discovery
       Service Boot Strapping Resource Offering.
<br>    
    2. Register user's Resource Offering at the ID-SIS-PP instance using
       Discovery Service Modification.
<br>    
    3. Send Discovery Service Lookup request, discovery service returns
       discovery lookup response to the WSC which contains the resource
       offering for the user's ID-SIS-PP instance.
<br>    
    4. Send Data Service Query to the ID-SIS-PP Instance to retrieve user
       attributes.
<br>    
    5. Send Data Service Modification to the ID-SIS-PP Instance to modify
       user attributes.
</p>
<h3>Setup</h3>
1. Deploy OpenSSO Enterprise server WAR (opensso.war) on machine A,
   and configure the IDFF sample to run as IDP. This instance will also act as
   DS and ID-SIS-PP role in the sample scenario.
<br>
2. Deploy OpenSSO Enterprise server WAR (opensso.war) on machine B,
   and configure the IDFF sample to run as SP. 
<br>
3. Create a user on IDP and a user on SP. Federate and signle sign on the users.
<br>
4. Deploy OpenSSO Enterprise client sample WAR (opensso-client-jdk14.war
   for web container running JDK 1.4.x or opensso-client-jdk15.war for
   web container running JDK 1.5.x) on
   machine B. If you want to deploy the war on different machine C, you need to
   create a configuration directoy on machine C and copy
   AMConfig.properties and FederationConfig.properties from machine B
   configuration directory to this configuration directory.
<br>
5. Click <a class="named" href="configure.jsp">here</a> to configure.
<br>
6. If you want to enable interaction for IDPP query and modify please see the
   section "Enable interaction for IDPP query and modify"
<br>
7. If you want to enable name id encryption in session context of discovery
   bootstrap, please see the section "Enable name id encryption in session
   context of discovery bootstrap".
<br>

<h3>Demonstration</h3>
After you have setup your machines, single sign on IDP and SP users then
visit this <a class="named" href="index.jsp">link</a> to try out this sample.


<h3 name="enc">Enable interaction for IDPP query and modify</h3>
On IDP machine turn on IDPP policy evaluation:<br>
1. Download or build ssoAdminTools.zip and install.<br>
2. Save administrator password in a file. And Run<br>
ssoadm set-attribute-defaults -s sunIdentityServerLibertyPPService -u amadmin -f &lt;admin password file name&gt; -t Global -a "sunIdentityServerPPisQueryPolicyEvalRequired=true"<br>

3. Run<br>
ssoadm set-attribute-defaults -s sunIdentityServerLibertyPPService -u amadmin -f &lt;admin password file name&gt; -t Global -a "sunIdentityServerPPisModifyPolicyEvalRequired=true"<br>

<br>
Create policy for IDPP query and modify:<br>
1. Bring up a browser and go to "&lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt;" and login into console as user 'amadmin'<br>
2. Click realm 'opensso'.<br>
3. Click 'Policies' tab.<br>
4. Click 'New Policy ...'<br>
5. Enter any policy name in the 'Name' text field.<br>
6. Click 'New...' under 'Rules' section.<br>
7. Select 'Liberty Personal Profile Service (with resource name) then click 'Next'.<br>
8. Enter any rule name in the 'Name' text field.<br>
9. Enter '*' in the 'Resource Name' text field.<br>
10. Click both check boxes next to action 'MODIFY' and 'QUERY' and select
    'interactForConsent' in both drop down menus under 'Value' then click
    'Finish'.<br>
11. Click 'New...' under 'Subjects' section.<br>
12. Select 'Authenticated Users' then click 'Next'.<br>
13. Enter user name of IDP user you created before (e.g. idp) in the 'Name'
    text field then click 'Finish'.<br>
14. Click 'OK' to save this policy.<br>
<br>
<h3 name="enc">Enable name id encryption in session context of discovery bootstrap</h3>
Set up keystore:<br>
1.  On IDP, SP and WSC machines(if different from SP machine), run <br>
   &lt;JDK Home&gt;/bin/keytool -genkey -keyalg rsa -alias test -dname "cn=sun-unix,ou=SUN Java System OpenSSO Enterprise,o=Sun, c=US" -keypass 11111111 -keystore &lt;configuration dir&gt;/keystore.jks -storepass 11111111
<br>
2. On IDP machine, go to &lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt;/encode.jsp and type '11111111' and click 'Encode'.
   Save encoded value to &lt;configuration dir&gt;/.storepass and
   &lt;configuration dir&gt;/.keypass<br>   
3. On SP machine go to &lt;SP protocol&gt;://&lt;SP hostname&gt;:&lt;SP port&gt;&lt;IDP depoly uri&gt;/encode.jsp and type '11111111' and click 'Encode'.
   Save encoded value to &lt;configuration dir&gt;/.storepass and
   &lt;configuration dir&gt;/.keypass<br>
4. If WSC machine is different from SP machine, copy
   &lt;configuration dir&gt;/.storepass and &lt;configuration dir&gt;/.keypass
   from SP to &lt;configuration dir&gt;/.storepass and
   &lt;configuration dir&gt;/.keypass to WSC machine.<br>

5. On IDP, SP and WSC(if different from SP machine) machines, edit &lt;configuration dir&gt;/FederationConfig.properties<br>
   com.sun.identity.saml.xmlsig.keystore= &lt;configuration dir&gt;/keystore.jks<br>
   com.sun.identity.saml.xmlsig.storepass= &lt;configuration dir&gt;/.storepass<br>
   com.sun.identity.saml.xmlsig.keypass= &lt;configuration dir&gt;/.keypass<br>
   com.sun.identity.saml.xmlsig.certalias=test<br>
<br>


Set up IDP machine:<br>
1. Download or build ssoAdminTools.zip and install.<br>
2. Run<br>
ssoadm set-attribute-defaults -s sunIdentityServerDiscoveryService -u amadmin -f &lt;admin password file name&gt; -t Global -a "sunIdentityServerDiscoProviderID=&lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt;"<br>
3. Run<br>
ssoadm set-attribute-defaults -s sunIdentityServerDiscoveryService -u amadmin -f &lt;admin password file name&gt; -t Global -a "sunIdentityServerBootstrappingEncryptNIinSessionContext=true"<br>
4. Run<br>
ssoadm show-attribute-defaults -s sunIdentityServerDiscoveryService -u amadmin -f &lt;admin password file name&gt; -t Global -a sunIdentityServerBootstrappingDiscoEntry<br>

5.Save 'sunIdentityServerBootstrappingDiscoEntry=...' in the previous step to a file 'datafile'<br>

6.Edit file 'datafile'<br>
Replace '&lt;ProviderID&gt;&lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt;/Liberty/disco&lt;/ProviderID&gt;' with '&lt;ProviderID&gt;&lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt;&lt;/ProviderID&gt;'<br>
Replace '&lt;SecurityMechID&gt;urn:liberty:security:2003-08:null:null&lt;/SecurityMechID&gt;' with '&lt;SecurityMechID&gt;urn:liberty:security:2003-08:null:SAML&lt;/SecurityMechID&gt;'<br>
Replace '&lt;/ResourceOffering&gt;&lt;/DiscoEntry&gt;' with  '&lt;/ResourceOffering&gt;&lt;AuthorizeRequester xmlns="urn:liberty:disco:2003-08"/&gt;&lt;/DiscoEntry&gt;'<br>

7. Run<br>
ssoadm set-attribute-defaults -s sunIdentityServerDiscoveryService -u amadmin -f &lt;admin password file name&gt; -t Global -D datafile<br>

8. Edit &lt;configuration dir&gt;/FederationConfig.properties<br>
com.sun.identity.liberty.ws.ta.certalias=test<br>
com.sun.identity.liberty.ws.trustedca.certaliases=test<br>
com.sun.identity.liberty.ws.wsc.certalias=test<br>

9. Run<br>
ssoadm delete-entity -e &lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt; -u amadmin -f &lt;admin password file name&gt; -c idff<br>

10. Run<br>
ssoadm delete-entity -e &lt;SP protocol&gt;://&lt;SP hostname&gt;:&lt;SP port&gt;&lt;SP depoly uri&gt; -u amadmin -f &lt;admin password file name&gt; -c idff<br>

11.Run<br>
ssoadm create-metadata-template -u amadmin -f &lt;admin password file name&gt; -e &lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt; -m /tmp/idpm -x /tmp/idpx -i /idp -b test -g test -c idff<br>

12. Edit file '/tmp/idpx'<br>
Change the value of attribute "enableNameIDEncryption" to "true"<br>

13. Run<br>
ssoadm import-entity -u amadmin -f &lt;admin password file name&gt; -m /tmp/idpm -x /tmp/idpx -t sampleidffcot -c idff<br>

14. Copy '/tmp/spm'(generated at step 4 in section "Set up SP machine" below) from SP machine to '/tmp/spm' on this machine<br>

15. Run<br>
ssoadm import-entity -u amadmin -f &lt;admin password file name&gt; -m /tmp/spm -t sampleidffcot -c idff<br>
<br>


Set up SP machine:<br>
1. Download or build ssoAdminTools.zip and install.<br>
2. Run<br>
ssoadm delete-entity -e &lt;IDP protocol&gt;://&lt;IDP hostname&gt;:&lt;IDP port&gt;&lt;IDP depoly uri&gt; -u amadmin -f &lt;admin password file name&gt; -c idff<br>

3. Run<br>
ssoadm delete-entity -e &lt;SP protocol&gt;://&lt;SP hostname&gt;:&lt;SP port&gt;&lt;SP depoly uri&gt; -u amadmin -f &lt;admin password file name&gt; -c idff<br>

4. Run<br>
ssoadm create-metadata-template -u amadmin -f &lt;admin password file name&gt; -e &lt;SP protocol&gt;://&lt;SP hostname&gt;:&lt;SP port&gt;&lt;SP depoly uri&gt; -m /tmp/spm -x /tmp/spx -s /sp -a test -r test -c idff<br>

5. Run<br>
ssoadm import-entity -u amadmin -f &lt;admin password file name&gt; -m /tmp/spm -x /tmp/spx -t sampleidffcot -c idff<br>

6. Copy '/tmp/idpm'(generated at step 11 in section "Set up IDP machine" above) from IDP machine to '/tmp/idpm' on this machine<br>

7. Run<br>
ssoadm import-entity -u amadmin -f &lt;admin password file name&gt; -m /tmp/idpm  -c idff -t sampleidffcot<br>

<br>
Restart web containers on IDP, SP and WSC machines

</td></tr></table>

</body>

