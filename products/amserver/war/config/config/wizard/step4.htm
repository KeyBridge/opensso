<script type="text/javascript">

    var userStoreHostValid = true;
    var userStorePortValid = true;
    var userStoreRootSuffixValid = true;
    var userStoreLoginIdValid = true;
    var userStorePasswordValid = false;
 
    function allValid() {
        $('nextTabButton').disabled = 
	    !(userStoreHostValid && 
		userStorePortValid &&
		userStoreRootSuffixValid &&
		userStoreLoginIdValid &&
		userStorePasswordValid);
    }
    
    function validateUserFields(response) {
        if (response.responseText == "ok") { 
	    eval(field + "Valid = true;" );
	    if (field == "userStorePassword") {
		field = "userStoreLoginId";
	    }
            $(field + 'Status').innerHTML = okString;
        } else {
            eval(field + "Valid = false;" );
	    if (field == "userStorePassword") {
		field = "userStoreLoginId";
	    }
            $(field + 'Status').innerHTML = errorImage +
                '<small>' + response.responseText + '</small>';
        }                
        allValid();
        field = "";
    }  

    function validateUserStoreHost() {
        field = "userStoreHost";
        var callUrl = "$context$path?actionLink=setHost";
        var param = "&host=" + $('userStoreHost').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }         
    
    function validateUserStorePort() {
        field = "userStorePort";
        var callUrl = "$context$path?actionLink=setPort";
        var param = "&port=" + $('userStorePort').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }       

    function validateUserStoreRootSuffix() {
        field = "userStoreRootSuffix";
        var callUrl = "$context$path?actionLink=setRootSuffix";
        var param = "&rootsuffix=" + escape($('userStoreRootSuffix').value);
        AjaxUtils.call(callUrl+param, validateUserFields);
    }
    
    function validateUserStoreLoginId() {
        field = "userStoreLoginId";
        var callUrl = "$context$path?actionLink=setLoginID";
        var param = "&dn=" + $('userStoreLoginId').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }    

    function validateUserStorePassword() {
        field = "userStorePassword";
        var callUrl = "$context$path?actionLink=setPassword";
        var param = "&password=" + $('userStorePassword').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }   
    
    function setAMDS() {
        setType(document.getElementById("ldapv3amds").value);
    }

    function setGeneric() {
        setType(document.getElementById("ldapv3").value);
    }

    function setType(type) {
        var callUrl = "$context$path?actionLink=setStoreType";
        AjaxUtils.call(callUrl + "&type=" + type);
    }
    
    var copyUserStoreSettings = false;
    function copyConfigStoreFieldsToUserStoreFields() {
        var checked = document.getElementById("userStoreSameAsConfigStore").checked;
        copyUserStoreSettings = checked;
        disableUserSettings(checked);
        if (checked == true) {
            $('userStoreHost').value = $('configStoreHost').value;
            $('userStorePort').value = $('configStorePort').value;
            $('userStoreLoginId').value = $('configStoreLoginId').value;
            $('userStorePassword').value = $('configStorePassword').value;
            $('userStoreRootSuffix').value = $('rootSuffix').value;          
	} 

        // the data store is the same as the config store so we don't 
        // need to pass in the data.
        AjaxUtils.call("$context$path?actionLink=clearData");                     
    }
    
    <!-- when embedded user config is selected -->
    function enableEmbeddedConfig() {
        userStoreChoice = "embedded";
        document.getElementById("userStoreSameAsConfigStore").disabled = true;
        
        document.getElementById("embeddedConfigSettings").style.display = "";
        document.getElementById("externalConfigSettings").style.display = "none";        
        
        $('nextTabButton').disabled = false;
        AjaxUtils.call("$context$path?actionLink=clearData");
    }
    
    <!-- when external config is selected -->
    function enableExternalConfig() {
        userStoreChoice = "external";
        if (userStore == "external") {
            document.getElementById("userStoreSameAsConfigStore").disabled = false;
        }
        
        document.getElementById("embeddedConfigSettings").style.display = "none";
        document.getElementById("externalConfigSettings").style.display = "";
        copyConfigStoreFieldsToUserStoreFields();
        disableUserSettings(false);
        $('nextTabButton').disabled = true;
        AjaxUtils.call("$context$path?actionLink=copyData");
    }
    
    function disableUserSettings(checked) {
        document.getElementById("userStoreHost").disabled = checked;
        document.getElementById("userStorePort").disabled = checked;
        document.getElementById("userStoreRootSuffix").disabled = checked;
        document.getElementById("userStoreLoginId").disabled = checked;
        document.getElementById("userStorePassword").disabled = checked;
        document.getElementById("ldapv3").disabled = checked;
        document.getElementById("ldapv3amds").disabled = checked;
    }

    function initUserStorePage() {
        document.getElementById("userStoreCustom").checked = true;
        if (userStore == "embedded") {
            document.getElementById("userStoreSameAsConfigStore").disabled = true;
            if (userStoreChoice == "embedded") {              
                document.getElementById("userStoreDefault").checked = true;   
                document.getElementById("embeddedConfigSettings").style.display = "";
                document.getElementById("externalConfigSettings").style.display = "none";              
            } else {
                enableExternalConfig();
            } 
        } else {
            document.getElementById("userStoreSameAsConfigStore").checked = true;
            enableExternalConfig();
            document.getElementById("userStoreDefault").disabled = true;            
        }
        $('nextTabButton').disabled = true;
    }
        
    YAHOO.util.Event.onDOMReady(initUserStorePage);
</script>

<div style="margin-left:10px;">
    <h1>$page.getLocalizedString("step4.title")<img class="pointer" src="$context/assets/images/message.gif"/></h1>
    <p>$page.getLocalizedString("step4.description")</p>
    
    <input type="radio" id="userStoreDefault" name="userStoreCustom" style="margin-left:1em" value="false" onclick="enableEmbeddedConfig();"/>
    <span>$page.getLocalizedString("configurator.embedded")</span><br/>
    <input type="radio" id="userStoreCustom" name="userStoreCustom" style="margin-left:1em" value="true" onclick="enableExternalConfig();"/>
    <span>$page.getLocalizedString("configurator.remote") 
        <input type="checkbox" id="userStoreSameAsConfigStore" checked="checked"
               name="userStoreSameAsConfigStore" style="margin-left:2em" 
               onclick="copyConfigStoreFieldsToUserStoreFields();"/>
        <span style="font-size:smaller">$page.getLocalizedString("copy.config.settings")</span>
    </span>
    
    <div id="userStoreModule" style="width:570px;">
        <p id="allfields"><em>*</em>&nbsp;$page.getLocalizedString("required.field.label")</p>
        <b class="xtop">
            <b class="xt1"></b>
            <b class="xt2"></b>
            <b class="xt3"></b>
            <b class="xt4"></b>
        </b>
        <div class="headerBox">$page.getLocalizedString("step4.sub.title")</div>
        <div class="bodyBox" style="height:200px;">	
            <div id="embeddedConfigSettings"
                style="margin-left:10px; display:none">
                <br>
                <img src="$context/assets/images/error.jpg">&nbsp;
                <b>$page.getLocalizedString("embedded.user.message")</b>
            </div>
            <span id="externalConfigSettings" style="display:none">
                <table class="temp">
                    <tr>
                        <td><label for="userStoreHost"><em>*&nbsp;</em>$page.getLocalizedString("directory.name.label")</label></td>
                        <td>
                            <input id="userStoreHost" name="userStoreHost" type="text" 
                                   class="text" style="width:150px"  
                                   onkeyup="APP.callDelayed(this, validateUserStoreHost)"/>
                            <span id="userStoreHostStatus"></span>                       
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePort"><em>*&nbsp;</em>$page.getLocalizedString("port.label")</label></td>
                        <td>
                            <input id="userStorePort" name="userStorePort" 
                                   type="text" class="text" size="5" maxLength="5" 
                                   onkeyup="APP.callDelayed(this, validateUserStorePort)"/>
                            <span id="userStorePortStatus"></span>         
                        </td>
                    </tr>  
                    <tr>
                        <td><label for="userStoreRootSuffix"><em>*&nbsp;</em>$page.getLocalizedString("root.suffix.label")</label></td>
                        <td>
                            <input id="userStoreRootSuffix" name="userStoreRootSuffix" 
                                   type="text" class="text" style="width:200px"  
                                   onkeyup="APP.callDelayed(this, validateUserStoreRootSuffix)"/>
                            <span id="userStoreRootSuffixStatus"></span>    
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStoreLoginId"><em>*&nbsp;</em>$page.getLocalizedString("login.id.label")</label></td>
                        <td>
                            <input id="userStoreLoginId" name="userStoreLoginId" 
                                   type="text" class="text" style="width:150px" 
                                   onkeyup="APP.callDelayed(this, validateUserStoreLoginId)"/>
                            <span id="userStoreLoginIdStatus"></span>                             
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePassword"><em>*&nbsp;</em>$page.getLocalizedString("password.label")</label></td>
                        <td>
                            <input id="userStorePassword" name="userStorePassword" 
                                   type="password" class="text" style="width:100px" 
                                   onkeyup="APP.callDelayed(this, validateUserStorePassword )"/>        
                        </td>
                    </tr>
                    <tr>
                        <td valign="top"><label for="userStoreType"><em>*&nbsp;</em>$page.getLocalizedString("store.type.label")</label></td>
                        <td>
                            <input type="radio" id="ldapv3amds" name="userStoreType" value="LDAPv3ForAMDS" checked="checked" onclick="setAMDS();"/>&nbsp;$page.getLocalizedString("am.ldap.schema")<br>
                            <input type="radio" id="ldapv3" name="userStoreType" value="LDAPv3" onclick="setGeneric();"/>&nbsp;$page.getLocalizedString("generic.ldap.schema")
                        </td>
                    </tr>            
                </table>
            </span>
        </div>
        <div>
            <b class="xbottom">
                <b class="xbGray1"></b>
                <b class="xbGray2"></b>
                <b class="xbGray3"></b>
                <b class="xbGray4"></b>
            </b>
        </div>
    </div>
</div>
