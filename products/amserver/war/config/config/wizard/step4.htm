<script type="text/javascript">
    var userStoreHostValid = true;
    var userStorePortValid = true;
    var userStoreRootSuffixValid = true;
    var userStoreLoginIdValid = true;
    var userStorePasswordValid = false;
 
    function allValid() {
        $('nextTabButton').disabled = 
	    !(userStoreHostValid && 
		userStorePortValid &&
		userStoreRootSuffixValid &&
		userStoreLoginIdValid &&
		userStorePasswordValid);
    }
    
    function validateUserFields(response) {
        if (response.responseText == "ok") { 
	    eval(field + "Valid = true;" );
            $(field + 'Status').innerHTML = okString;
        } else {
            eval(field + "Valid = false;" );
            $(field + 'Status').innerHTML = errorImage +
                '<small>' + response.responseText + '</small>';
        }                
        allValid();
        field = "";
    }  

    function validateUserStoreSSL() {
        field = "userStoreSSL";
        var callUrl = "$context$path?actionLink=setSSL";
        var value = ($('userStoreSSL').checked) ? "SSL" : "SIMPLE";
        var param = "&ssl=" + value;
        AjaxUtils.call(callUrl+param, validateSSLField);
    }

    function validateSSLField() {
        //no op
    }

    function validateUserStoreHost() {
        field = "userStoreHost";
        var callUrl = "$context$path?actionLink=setHost";
        var param = "&host=" + $('userStoreHost').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }         
    
    function validateUserStorePort() {
        field = "userStorePort";
        var callUrl = "$context$path?actionLink=setPort";
        var param = "&port=" + $('userStorePort').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }       

    function validateUserStoreRootSuffix() {
        field = "userStoreRootSuffix";
        var callUrl = "$context$path?actionLink=setRootSuffix";
        var param = "&rootsuffix=" + escape($('userStoreRootSuffix').value);
        AjaxUtils.call(callUrl+param, validateUserFields);
    }
    
    function validateUserStoreLoginId() {
        field = "userStoreLoginId";
        var callUrl = "$context$path?actionLink=setLoginID";
        var param = "&dn=" + $('userStoreLoginId').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }    

    function validateUserStorePassword() {
        field = "userStorePassword";
        var callUrl = "$context$path?actionLink=setPassword";
        var param = "&password=" + $('userStorePassword').value;
        AjaxUtils.call(callUrl+param, validateUserFields);
    }   
    
    function setAMDS() {
        setType(document.getElementById("ldapv3amds").value);
    }

    function setGeneric() {
        setType(document.getElementById("ldapv3").value);
    }

    function setType(type) {
        var callUrl = "$context$path?actionLink=setStoreType";
        AjaxUtils.call(callUrl + "&type=" + type);
    }
    
    <!-- when embedded user config is selected -->
    function enableEmbeddedConfig() {
        userStoreChoice = "embedded";
        document.getElementById("embeddedConfigSettings").style.display = "";
        document.getElementById("externalConfigSettings").style.display = "none";        
        $('nextTabButton').disabled = false;
        AjaxUtils.call("$context$path?actionLink=setUMEmbedded");
    }
    
    <!-- when external config is selected -->
    function enableExternalConfig() {
        userStoreChoice = "external";
        document.getElementById("embeddedConfigSettings").style.display = "none";
        document.getElementById("externalConfigSettings").style.display = "";
        allValid();
        AjaxUtils.call("$context$path?actionLink=resetUMEmbedded");
    }
    
    function initUserStorePage() {
        if ( "$EXT_DATA_STORE" == "true" ) {
            enableExternalConfig();
        } else {
            enableEmbeddedConfig();
        }
    }
        
    YAHOO.util.Event.onDOMReady(initUserStorePage);
</script>

<div style="margin-left:10px;">
    <h1>$page.getLocalizedString("step4.title")<img class="pointer" src="$context/assets/images/message.gif"/></h1>
    <p>$page.getLocalizedString("step4.description")</p>
    
    <input type="radio" id="userStoreDefault" name="userStoreCustom"
        style="margin-left:1em" value="false" $selectEmbeddedUM
        onclick="enableEmbeddedConfig();"/>
    <span>$page.getLocalizedString("configurator.embedded")</span><br/>

    <input type="radio" id="userStoreCustom" name="userStoreCustom"
        style="margin-left:1em" value="true" $selectExternalUM
        onclick="enableExternalConfig();"/>
    <span>$page.getLocalizedString("configurator.remote")</span>
    
    <div id="userStoreModule" style="width:570px;">
        <p id="allfields"><em>*</em>&nbsp;$page.getLocalizedString("required.field.label")</p>
        <b class="xtop">
            <b class="xt1"></b>
            <b class="xt2"></b>
            <b class="xt3"></b>
            <b class="xt4"></b>
        </b>
        <div class="headerBox">$page.getLocalizedString("step4.sub.title")</div>
        <div class="bodyBox" style="height:220px;">	
            <div id="embeddedConfigSettings"
                style="margin-left:10px; display:none">
                <br>
                <img src="$context/assets/images/error.jpg">&nbsp;
                <b>$page.getLocalizedString("embedded.user.message")</b>
            </div>
            <span id="externalConfigSettings" style="display:none">
                <table class="temp">
                    <tr>
                        <td><label for="userStoreSSL"><em>*&nbsp;</em>$page.getLocalizedString("directory.ssl.label")</label></td>
                        <td>
                            <input id="userStoreSSL" name="userStoreSSL"
                                type="checkbox" value="SSL" $selectUserStoreSSL
                                onClick="APP.callDelayed(this, validateUserStoreSSL)"/>
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStoreHost"><em>*&nbsp;</em>$page.getLocalizedString("directory.name.label")</label></td>
                        <td>
                            <input id="userStoreHost" name="userStoreHost" type="text" 
                                   class="text" style="width:150px"  
                                   value="$userStoreHost"
                                   onkeyup="APP.callDelayed(this, validateUserStoreHost)"/>
                            <span id="userStoreHostStatus"></span>                       
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePort"><em>*&nbsp;</em>$page.getLocalizedString("port.label")</label></td>
                        <td>
                            <input id="userStorePort" name="userStorePort" 
                                   type="text" class="text" size="5" maxLength="5" 
                                   value="$userStorePort"
                                   onkeyup="APP.callDelayed(this, validateUserStorePort)"/>
                            <span id="userStorePortStatus"></span>         
                        </td>
                    </tr>  
                    <tr>
                        <td><label for="userStoreRootSuffix"><em>*&nbsp;</em>$page.getLocalizedString("root.suffix.label")</label></td>
                        <td>
                            <input id="userStoreRootSuffix" name="userStoreRootSuffix" 
                                   type="text" class="text" style="width:200px"  
                                   value="$userStoreRootSuffix"
                                   onkeyup="APP.callDelayed(this, validateUserStoreRootSuffix)"/>
                            <span id="userStoreRootSuffixStatus"></span>    
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStoreLoginId"><em>*&nbsp;</em>$page.getLocalizedString("login.id.label")</label></td>
                        <td>
                            <input id="userStoreLoginId" name="userStoreLoginId" 
                                   type="text" class="text" style="width:150px" 
                                   value="$userStoreLoginId"
                                   onkeyup="APP.callDelayed(this, validateUserStoreLoginId)"/>
                            <span id="userStoreLoginIdStatus"></span>                             
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePassword"><em>*&nbsp;</em>$page.getLocalizedString("password.label")</label></td>
                        <td>
                            <input id="userStorePassword" name="userStorePassword" 
                                   type="password" class="text" style="width:100px" 
                                   onkeyup="APP.callDelayed(this, validateUserStorePassword )"/>        
                             <span id="userStorePasswordStatus"></span>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top"><label for="userStoreType"><em>*&nbsp;</em>$page.getLocalizedString("store.type.label")</label></td>
                        <td>
                            <input type="radio" id="ldapv3amds" name="userStoreType" value="LDAPv3ForAMDS" $selectLDAPv3amds onclick="setAMDS();"/>&nbsp;$page.getLocalizedString("am.ldap.schema")<br>
                            <input type="radio" id="ldapv3" name="userStoreType" value="LDAPv3" $selectLDAPv3 onclick="setGeneric();"/>&nbsp;$page.getLocalizedString("generic.ldap.schema")
                        </td>
                    </tr>            
                </table>
            </span>
        </div>
        <div>
            <b class="xbottom">
                <b class="xbGray1"></b>
                <b class="xbGray2"></b>
                <b class="xbGray3"></b>
                <b class="xbGray4"></b>
            </b>
        </div>
    </div>
</div>
