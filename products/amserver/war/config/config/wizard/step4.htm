<script type="text/javascript">

    var statusField;
    function validated(response) {
        if (response.responseText == "ok") {
            $(statusField).innerHTML = '<img class="pointer" src="$context/assets/images/check_true.JPG"> ' +
                  '<small>ok</small>';               
        } else {
            $(statusField).innerHTML = response.responseText;
        }
    }
    
    function validateUserStoreHost() {
        statusField = "userStoreHostStatus";
        var callUrl = "$context$path?actionLink=setHost";
        var param = "&host=" + $('userStoreHost').value;
        AjaxUtils.call(callUrl+param, validated);
    }         
    
    function validateUserStorePort() {
        statusField = "userStorePortStatus";
        var callUrl = "$context$path?actionLink=setPort";
        var param = "&port=" + $('userStorePort').value;
        AjaxUtils.call(callUrl+param, validated);
    }       

    function validateUserStoreRootSuffix() {
        statusField = "userStoreRootSuffixStatus";
        var callUrl = "$context$path?actionLink=setRootSuffix";
        var param = "&rootsuffix=" + $('userStoreRootSuffix').value;
        AjaxUtils.call(callUrl+param, validated);
    }
    
    function validateUserStoreLoginId() {
        statusField = "userStoreLoginIdStatus";
        var callUrl = "$context$path?actionLink=setLoginID";
        var param = "&dn=" + $('userStoreLoginId').value;
        AjaxUtils.call(callUrl+param, validated);
    }    

    function validateUserStorePassword() {
        statusField = "userStoreLoginIdStatus";
        var callUrl = "$context$path?actionLink=setPassword";
        var param = "&password=" + $('userStorePassword').value;
        AjaxUtils.call(callUrl+param, validated);
    }   
    
    function setAMDS() {
        setType(document.getElementById("ldapv3amds").value)
	setType
    }

    function setGeneric() {
        setType(document.getElementById("ldapv3").value);
    }

    function setType(type) {
        var callUrl = "$context$path?actionLink=setStoreType";
        AjaxUtils.call(callUrl + "&type=" + type);
    }
    
    var copyUserStoreSettings = false;
    function copyConfigStoreFieldsToUserStoreFields() {
        var checked = document.getElementById("userStoreSameAsConfigStore").checked;
        copyUserStoreSettings = checked;
        disableUserSettings(checked);
        if (checked == true) {
            $('userStoreHost').value = $('configStoreHost').value;
            $('userStorePort').value = $('configStorePort').value;
            $('userStoreLoginId').value = $('configStoreLoginId').value;
            $('userStorePassword').value = $('configStorePassword').value;
            $('userStoreRootSuffix').value = $('rootSuffix').value;          
	} 

        // the data store is the same as the config store so we don't 
        // need to pass in the data.
        AjaxUtils.call("$context$path?actionLink=clearData");                     
    }
    
    <!-- when embedded user config is selected -->
    function disableUserConfig() {
        document.getElementById("userStoreSameAsConfigStore").disabled = true;
        disableUserSettings(true);
        
        AjaxUtils.call("$context$path?actionLink=clearData");
    }
    
    <!-- when external config is selected -->
    function enableUserConfig() {
        if (userStore == "external") {
            document.getElementById("userStoreSameAsConfigStore").disabled = false;
        }
        disableUserSettings(copyUserStoreSettings);
        
        //AjaxUtils.call("$context$path?actionLink=loadSchema&schema="+value);
    }
    
    function disableUserSettings(checked) {
        document.getElementById("userStoreHost").disabled = checked;
        document.getElementById("userStorePort").disabled = checked;
        document.getElementById("userStoreRootSuffix").disabled = checked;
        document.getElementById("userStoreLoginId").disabled = checked;
        document.getElementById("userStorePassword").disabled = checked;
        document.getElementById("ldapv3").disabled = checked;
        document.getElementById("ldapv3amds").disabled = checked;
    }

    function initUserStorePage() {
        disableUserSettings(true);
        if (userStore == "embedded") {
            document.getElementById("userStoreSameAsConfigStore").disabled = true;
            document.getElementById("userStoreDefault").checked = true;
        } else {
            document.getElementById("userStoreDefault").disabled = true;
            document.getElementById("userStoreCustom").checked = true;
            copyConfigStoreFieldsToUserStoreFields();
        }
    }
    

    
    YAHOO.util.Event.onDOMReady(initUserStorePage);
</script>

<div style="margin-left:10px;">
    <h1>$page.getLocalizedString("step4.title")<img class="pointer" src="$context/assets/images/message.gif"/></h1>
    <p>$page.getLocalizedString("step4.description")</p>
    
    <input type="radio" id="userStoreDefault" name="userStoreCustom" style="margin-left:1em" value="false" onclick="disableUserConfig();"/>
    <span>$page.getLocalizedString("configurator.embedded")</span><br/>
    <input type="radio" id="userStoreCustom" name="userStoreCustom" style="margin-left:1em" value="true" onclick="enableUserConfig();"/>
    <span>$page.getLocalizedString("configurator.remote")
        <input type="checkbox" id="userStoreSameAsConfigStore" checked="checked"
               name="userStoreSameAsConfigStore" style="margin-left:2em" 
               onclick="copyConfigStoreFieldsToUserStoreFields();"/>
        <span style="font-size:smaller">$page.getLocalizedString("copy.config.settings")</span>
    </span>
    
    <div id="userStoreModule" style="width:570px;">
        <p id="allfields"><em>*</em>&nbsp;$page.getLocalizedString("required.field.label")</p>
        <b class="xtop">
            <b class="xt1"></b>
            <b class="xt2"></b>
            <b class="xt3"></b>
            <b class="xt4"></b>
        </b>
        <div class="headerBox">$page.getLocalizedString("step4.sub.title")</div>
        <div class="bodyBox" style="height:200px;">	
            <span>
                <table class="temp">
                    <tr>
                        <td><label for="userStoreHost"><em>*&nbsp;</em>$page.getLocalizedString("directory.name.label")</label></td>
                        <td>
                            <input id="userStoreHost" name="userStoreHost" type="text" 
                                   class="text" style="width:150px"  
                                   onkeyup="APP.callDelayed(this, validateUserStoreHost)"/>
                            <span id="userStoreHostStatus"></span>                       
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePort"><em>*&nbsp;</em>$page.getLocalizedString("port.label")</label></td>
                        <td>
                            <input id="userStorePort" name="userStorePort" 
                                   type="text" class="text" size="5" maxLength="5" 
                                   onkeyup="APP.callDelayed(this, validateUserStorePort)"/>
                            <span id="userStorePortStatus"></span>         
                        </td>
                    </tr>  
                    <tr>
                        <td><label for="userStoreRootSuffix"><em>*&nbsp;</em>$page.getLocalizedString("root.suffix.label")</label></td>
                        <td>
                            <input id="userStoreRootSuffix" name="userStoreRootSuffix" 
                                   type="text" class="text" style="width:200px"  
                                   onkeyup="APP.callDelayed(this, validateUserStoreRootSuffix)"/>
                            <span id="userStoreRootSuffixStatus"></span>    
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStoreLoginId"><em>*&nbsp;</em>$page.getLocalizedString("login.id.label")</label></td>
                        <td>
                            <input id="userStoreLoginId" name="userStoreLoginId" 
                                   type="text" class="text" style="width:150px" 
                                   onkeyup="APP.callDelayed(this, validateUserStoreLoginId )"/>
                            <span id="userStoreLoginIdStatus"></span>                             
                        </td>
                    </tr>
                    <tr>
                        <td><label for="userStorePassword"><em>*&nbsp;</em>$page.getLocalizedString("password.label")</label></td>
                        <td>
                            <input id="userStorePassword" name="userStorePassword" 
                                   type="password" class="text" style="width:100px" 
                                   onkeyup="APP.callDelayed(this, validateUserStorePassword )"/>        
                        </td>
                    </tr>
                    <tr>
                        <td valign="top"><label for="userStoreType"><em>*&nbsp;</em>$page.getLocalizedString("store.type.label")</label></td>
                        <td>
                            <input type="radio" id="ldapv3amds" name="userStoreType" value="LDAPv3ForAMDS" checked="checked" onclick="setAMDS();"/>&nbsp;$page.getLocalizedString("am.ldap.schema")<br>
                            <input type="radio" id="ldapv3" name="userStoreType" value="LDAPv3" onclick="setGeneric();"/>&nbsp;$page.getLocalizedString("generic.ldap.schema")
                        </td>
                    </tr>            
                </table>
            </span>
        </div>
        <div>
            <b class="xbottom">
                <b class="xbGray1"></b>
                <b class="xbGray2"></b>
                <b class="xbGray3"></b>
                <b class="xbGray4"></b>
            </b>
        </div>
    </div>
</div>
