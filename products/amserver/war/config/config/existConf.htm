<script type="text/javascript">

    YAHOO.namespace("sun.identity.config.options.existConf");

    var $ = YAHOO.util.Dom.get;

    function cancel() {
        document.location = "$context/config/options.htm";
    }

    function writingFailed( body ) {
        alert( "Writing configuration failed! [" + body + "]" );
    }

    function writingComplete( body ) {
        //the actual call happens really fast - so, simulate a longer writing process for better user experience
        //(otherwise looks very chopping - almost instantaneous)
        setTimeout( "YAHOO.sun.identity.config.options.existConf.writeConf.hide()", 1500);
        setTimeout( "YAHOO.sun.identity.config.options.existConf.confComplete.show()", 1500);
    }

    function createConf() {

        var params = "indices=";

        var selected = false;

        for ( var i = 1; i <= $existingConfigs.size(); i++ ) {
            var option = $('configOption' + i );
            if ( option.checked ) {
                if ( !selected ) {
                    params += i;
                } else {
                    params += "," + i;
                }
                selected = true;
            }
        }

        if ( !selected ) {
            alert( "Please choose at least one existing configuration.");
            return;
        }

        YAHOO.sun.identity.config.options.existConf.writeConf.show();

        APP.call( "$context$path", "writeConfig", params, writingComplete, writingFailed );
    }

    function launchConsole() {
        document.location = "$context/config/commonTasks.htm";
    }

    function init() {
        YAHOO.sun.identity.config.options.existConf.writeConf = new YAHOO.widget.Panel("writeConf", { width:"240px", fixedcenter:true, close:false, draggable:false, zindex:4, modal:true, visible:false });
        YAHOO.sun.identity.config.options.existConf.writeConf.setHeader("Writing configuration.  Please wait...");
        YAHOO.sun.identity.config.options.existConf.writeConf.setBody('<img src="$context/assets/images/rel_interstitial_loading.gif" />');
        YAHOO.sun.identity.config.options.existConf.writeConf.render(document.body);

        YAHOO.sun.identity.config.options.existConf.confComplete = new YAHOO.widget.Panel("confComplete", { fixedcenter: true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.existConf.confComplete.render();
    }

    YAHOO.util.Event.onDOMReady(init);

</script>
<div align="left" style="width:700px">
    <h1>Use an existing configuration</h1>

    <h2 style="color:#000000">Select the configuration you are adding to</h2>
	<div style="width: 460px;">
		<b class="xtop"><b class="xt1"></b><b class="xt2"></b><b class="xt3"></b><b class="xt4"></b></b>
		<div class="headerBox">Configurations</div>
		<div class="bodyBox">
			#if ( $existingConfigs.empty )
			<p>There are no existing configurations to use at this time.</p>
			#else
				#foreach( $url in $existingConfigs )
				<p>&nbsp;<input id="configOption${velocityCount}" type="checkbox"/>$url</p>
				#end
			#end
		</div>
		<b class="xbottom"><b class="xbGray1"></b><b class="xbGray2"></b><b class="xbGray3"></b><b class="xbGray4"></b></b>
		<br />
		<p align="right">
			<button type="button" value="Cancel" onClick="cancel();">Cancel</button>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<button type="button" value="AcddConf" onClick="createConf();">Add to Configuration</button>
		</p>
    </div>
</div>
<div id="confComplete" style="visibility:hidden">
    <div class="header">Configuration Complete</div>
    <div class="bd">
        <div class="bodyPopup borderPopUpGray" align="center" style="background:#FFFFFF">
            <h1>Configuration Complete!</h1>
            <p align="center" class="blueSmall">
                <a class="pointer" href="#" onclick="launchConsole(); return false">Launch the console</a>
            </p>
        </div>
    </div>
</div>
