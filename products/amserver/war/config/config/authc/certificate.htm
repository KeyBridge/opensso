<script language="javascript">

    YAHOO.util.Event.onDOMReady(initCertificate);

    var userIdOptionSelected = false;
    var ldpaActivated = false
    var userStoreNameValid = false;
    var userHostNameValid = false;
    var userHostPortValid = true;
    var userLoginValid = false;
    var userPasswordValid = false;
    var userBaseDNValid = false;


    function initCertificate() {
        pageURI = "$context$path";
        afterAddToStoreSuccessFunction = certificateAfterAddToStore;
        validateFormFunction = validateCertificateForm;
        adjustAddStoreButton();        
    }

    function certificateAfterAddToStore() {
        YAHOO.sun.container.addStore.show();
        setTimeout("YAHOO.sun.container.addStore.hide()",1250);
        setTimeout("document.location = '$context/commonTasks.htm'",1250);
    }

    function showOption(checkBox, type) {
        if (type == 1) {
            ldpaActivated = checkBox.checked;
        }
        DOM.setStyle(DOM.get("option" + type), "display", (checkBox.checked) ? "" : "none");
        adjustAddStoreButton();
    }

    function selectUserIdOption() {
        userIdOptionSelected = true;
        adjustAddStoreButton();
    }

    function validateUserStoreName() {
        var callUrl = pageURI + "?actionLink=validateStoreName&storeName=" + DOM.get("user_storeName").value;
        AjaxUtils.call(callUrl, userStoreNameValidated);
    }

    function validateUserHostName() {
        var callUrl = pageURI + "?actionLink=validateHost&hostName=" + DOM.get("user_hostName").value;
        AjaxUtils.call(callUrl, userHostNameValidated);
    }

    function validateUserHostPort() {
        var callUrl = pageURI + "?actionLink=validatePort&hostPort=" + DOM.get("user_hostPort").value;
        AjaxUtils.call(callUrl, userHostPortValidated);
    }

    function validateUserLogin() {
        var callUrl = pageURI + "?actionLink=validateLogin&login=" + DOM.get("user_login").value;
        AjaxUtils.call(callUrl, userLoginValidated);
    }

    function validateUserPassword() {
        var callUrl = pageURI + "?actionLink=validatePassword&password=" + DOM.get("user_password").value;
        AjaxUtils.call(callUrl, userPasswordValidated);
    }

    function validateUserBaseDN() {
        var callUrl = pageURI + "?actionLink=validateBaseDN&baseDN=" + DOM.get("user_baseDN").value;
        AjaxUtils.call(callUrl, userBaseDNValidated);
    }

    function userStoreNameValidated(response) {
        userStoreNameValid = (response.responseText == "true");
        if (userStoreNameValid) {
            DOM.get("user_storeNameStatus").innerHTML = "<img class='hand' src='$context/assets/images/check_true.JPG'>&nbsp;<small>Store name provided</small>";
       }
        else {
            DOM.get("user_storeNameStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function userHostNameValidated(response) {
        userHostNameValid = (response.responseText == "true");
        if (userHostNameValid) {
            DOM.get("user_hostNameStatus").innerHTML = "<img class='hand' src='$context/assets/images/check_true.JPG'>&nbsp;<small>Located Directory</small>";
       }
        else {
            DOM.get("user_hostNameStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function userHostPortValidated(response) {
        userHostPortValid = (response.responseText == "true");
        if (userHostPortValid) {
            DOM.get("user_hostPortStatus").innerHTML = "";
       }
        else {
            DOM.get("user_hostPortStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function userLoginValidated(response) {
        userLoginValid = (response.responseText == "true");
        if (userLoginValid) {
            DOM.get("user_loginStatus").innerHTML = "<img class='hand' src='$context/assets/images/check_true.JPG'>&nbsp;<small>Logged in</small>";
       }
        else {
            DOM.get("user_loginStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function userPasswordValidated(response) {
        userPasswordValid = (response.responseText == "true");
        if (userPasswordValid) {
            DOM.get("user_passwordStatus").innerHTML = "";
       }
        else {
            DOM.get("user_passwordStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function userBaseDNValidated(response) {
        userBaseDNValid = (response.responseText == "true");
        if (userBaseDNValid) {
            DOM.get("user_baseDNStatus").innerHTML = "<img alt='info' class='hand' src='$context/assets/images/check_true.JPG'>&nbsp;<small>Located Base DN</small><br/>";
       }
        else {
            DOM.get("user_baseDNStatus").innerHTML = "<small>" + response.responseText + "</small>";
        }
        adjustAddStoreButton();
    }

    function validateCertificateForm() {
        return (userIdOptionSelected &&
                (ldpaActivated ? (userStoreNameValid
                                  && userHostNameValid
                                  && userHostPortValid
                                  && userLoginValid
                                  && userPasswordValid
                                  && userBaseDNValid)
                                  : true));
    }


</script>
        
<div id="certificateMainPanel" align="center">
	<div id="certificateCreatePanel" class="createpanel">
		<form id="certificateForm" >
            <div class="bodywhite" >
                <p class="OrangeSmall">Certificate User ID attribute:&nbsp;<img class="balloonIcon" src="$context/assets/images/balloon_icon.png" alt="#"/></p>
                <input type="radio" name="userId" id="userId1" value="Subject CN" onchange="selectUserIdOption();"/>&nbsp;Subject CN<br />
                <input type="radio" name="userId" id="userId2" value="Subject DN" onchange="selectUserIdOption();"/>&nbsp;Subject DN<br />
                <input type="radio" name="userId" id="userId3" value="Email Address" onchange="selectUserIdOption();"/>&nbsp;Email Address<br />
                <input type="radio" name="userId" id="userId4" value="Subject UID" onchange="selectUserIdOption();"/>&nbsp;Subject UID	<br />
                <input type="radio" name="userId" id="userId5" value="Other" onchange="selectUserIdOption();"/>&nbsp;Other	<br />
            </div>
            <div class="bodywhite" >
                <p class="OrangeSmall">Additional certificate options (not required):</p>
                <input type="checkbox" name="checkAgainstLDAP" id="checkAgainstLDAP" onclick="showOption(this, 1); this.value = (this.checked ? 'true' : 'false');"/>&nbsp;Check the certificate against the LDAP Directory&nbsp;<img class="balloonIcon" src="$context/assets/images/balloon_icon.png" alt="#"/><br />
                <div id="option1" style="display:none">
                        <div class="bodywhite">
                            <div class="OrangeVerySmall" id="allfields">* ALL Fields are Required</div><br />
                            <div class="width_160">
								<p>User Store Name:</p>
							</div>
                            <p><input class="inputsBlue" type="text" id="user_storeName" name="user_storeName" style="width:150px" value="$!certificateStore.userStore.name" onkeyup="APP.callDelayed(this, validateUserStoreName);"/>
                            <span id="user_storeNameStatus"></span></p>
                        </div>
                        <div class="bodywhite">
                            <div class="width_160">
								<p>Directory Host Name:</p>
								<p>Port:</p>
								<p>Is this a secure port?:</p>
							</div>
                            <p><input class="inputsBlue" type="text" id="user_hostName" name="user_hostName" style="width:150px" value="$!certificateStore.userStore.hostName" onkeyup="APP.callDelayed(this, validateUserHostName);"/>
                            <span id="user_hostNameStatus"></span></p>

                            <p><input class="inputsBlue" type="text" id="user_hostPort" name="user_hostPort" style="width:40px" value="$!certificateStore.userStore.hostPort" onkeyup="APP.callDelayed(this, validateUserHostPort);"/>
                            <span id="user_hostPortStatus"></span></p>

                            <p><input type="radio" id="user_hostPortSecureNo" name="user_hostPortSecure" checked="checked" value="false"/>&nbsp;No&nbsp;
                            <input type="radio" id="user_hostPortSecureYes" name="user_hostPortSecure" value="true"/>Yes</p>
                        </div>
                        <div class="bodywhite">
                            <div class="width_160">
								<p>Directory Login ID:</p>
								<p>Directory Password:</p>
							</div>
                            <p><input class="inputsBlue" type="text" id="user_login" name="user_login" style="width:150px" value="$!certificateStore.userStore.login" onkeyup="APP.callDelayed(this, validateUserLogin);"/>
                            <span id="user_loginStatus"></span></p>

                            <p><input class="inputsBlue" type="text" id="user_password" name="user_password" style="width:150px" onkeyup="APP.callDelayed(this, validateUserPassword);"/>
                            <span id="user_passwordStatus"></span></p>
                        </div>
                        <div class="bodywhite">
                            <div class="width_160">
								<p>Directory Base DN:</p>
								<p>Search Attribute<img class="balloonIcon" src="$context/assets/images/balloon_icon.png" alt="#"/></p>
							</div>
                            <p><input class="inputsBlue" type="text" id="user_baseDN" name="user_baseDN" style="width:150px" value="$!certificateStore.userStore.baseDN" onkeyup="APP.callDelayed(this, validateUserBaseDN);"/>
                            <span id="user_baseDNStatus"></span></p>
                            <p><select><option>Select One ...</option></select></p>
                        </div>
                 </div>
                <input type="checkbox" name="checkAgainstCRL" id="checkAgainstCRL" onclick="showOption(this, 2); this.value = (this.checked ? 'true' : 'false');"/>&nbsp;Check the certificate against the certificate revocation list (CRL)&nbsp;<img class="balloonIcon" src="$context/assets/images/balloon_icon.png" alt="#"/><br />
                <div id="option2" style="display:none;padding-left:20px">
                    the search attribute is from the issuer's certificate<br />
                    Search Attribute:&nbsp;
                    <input class="inputsBlue" type="text" id="searchAttribute" name="searchAttribute" style="width:150px"/><br />
                </div>
                <input type="checkbox" name="checkAgainstOSCP" id="checkAgainstOSCP" onclick="this.value = (this.checked ? 'true' : 'false');"/>&nbsp;Check the certificate against OSCP&nbsp;<img class="balloonIcon" src="$context/assets/images/balloon_icon.png" alt="#"/><br />
            </div>
		</form>
	</div>
</div>
