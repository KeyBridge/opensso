<script type="text/javascript">
    YAHOO.namespace("sun.identity.config.options");

    //convenient alias:
    var $ = YAHOO.util.Dom.get;

    function launchConsole() {
        document.location = "$context/UI/Login";
    }

    /* #if ( $upgrade )
     */

    function downloadInstructions() {
        /* TODO - enable download - where does this file reside? */
        alert( "Not implemented!" );
    }

    function onUpgradeOlderResponse( response ) {
        //for now, these methods are the same:
        onCoexistResponse( response );
    }
    function upgradeOlder() {
        YAHOO.sun.identity.config.options.upgrading.show();
        AjaxUtils.call( "$context$path?actionLink=olderUpgradeLink", onUpgradeOlderResponse );
    }

    function onCoexistResponse( response ) {
        if ( response.responseText == "true" ) {
            //operation was successful, hide the writing dialog, show the confComplete:

            //in actuality, this usually happens very fast, so put a delay when removing the testUrlPanel.
            //if we don't do this, the window blinks and looks unsightly, so we actually impose an unnecessary
            //gui delay for a slightly cleaner 'expected' UI experience:
            setTimeout("YAHOO.sun.identity.config.options.upgrading.hide()", 1500);
            setTimeout("YAHOO.sun.identity.config.options.upgradePartiallyComplete.show()", 1500);
        } else {
            //TODO - show a specific (nice looking) error message dialog that explains why the upgrade failed.
            //for now, just alert:
            alert( "Unexpected error: [" + response.responseText + "].  Please contact your System " +
                   "Administrator.  If you are the System Administrator, please direct your questions to the " +
                   "OpenSSO user's mailing list for help.");
        }                                                                                                realm/RMRealm
    }
    function coexist() {
        YAHOO.sun.identity.config.options.upgrading.show();
        AjaxUtils.call( "$context$path?actionLink=coexistLink", onCoexistResponse );
    }

    function onUpgradeResponse( response ) {
        if ( response.responseText == "true" ) {
            //operation was successful, hide the writing dialog, show the confComplete:

            //in actuality, this usually happens very fast, so put a delay when removing the testUrlPanel.
            //if we don't do this, the window blinks and looks unsightly, so we actually impose an unnecessary
            //gui delay for a slightly cleaner 'expected' UI experience:
            setTimeout("YAHOO.sun.identity.config.options.upgrading.hide()", 1500);
            setTimeout("YAHOO.sun.identity.config.options.upgradeComplete.show()", 1500);
        } else {
            //TODO - show a specific (nice looking) error message dialog that explains why the upgrade failed.
            //for now, just alert:
            alert( "Unexpected error: [" + response.responseText + "].  Please contact your System " +
                   "Administrator.  If you are the System Administrator, please direct your questions to the " +
                   "OpenSSO user's mailing list for help.");
        }

    }
    function upgrade() {
        YAHOO.sun.identity.config.options.confirmUpgrade.hide();
        YAHOO.sun.identity.config.options.upgrading.show();
        AjaxUtils.call( "$context$path?actionLink=upgradeLink", onUpgradeResponse );
    }
    function showConfirmUpgradePanel() {
        YAHOO.sun.identity.config.options.confirmUpgrade.show();
    }
    function cancelUpgrade() {
        YAHOO.sun.identity.config.options.confirmUpgrade.hide();
    }
    /* #else
     */
    var passwordUpdateRequired = $passwordUpdateRequired;
    var configOption = 0;


    
    
    function onDefaultSummarySuccess( response ) {
        var formError = (response != null && (response.getResponseHeader["formError"] != null));
        YAHOO.sun.identity.config.options.inProgress.hide();
        if ( !formError ) {            
            YAHOO.sun.identity.config.options.defaultSummary.hide(); 
            YAHOO.sun.identity.config.options.confComplete.show();
        } else {
            YAHOO.sun.identity.config.options.defaultSummary.show();
        }
    }
    
    function onDefaultSummaryFailure(response ) {
        YAHOO.sun.identity.config.options.defaultSummary.hide();
        alert("configuration failed");
        document.location = "$context/config/options.htm";
    }
    
    function submitDefaultSummaryForm() {
        YAHOO.sun.identity.config.options.defaultSummary.hide(); 
        YAHOO.sun.identity.config.options.inProgress.show();
        AjaxUtils.doPost("defaultSummary", "$context/config/defaultSummary.htm", AjaxUtils.serializeForm("defaultForm"), onDefaultSummarySuccess, onDefaultSummaryFailure);
    }
    
    function renderDefaultSummary() {
        YAHOO.sun.identity.config.options.defaultSummary = new YAHOO.widget.Dialog("defaultSummary", { width:"450px", fixedcenter: true, modal: true, close: true, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.defaultSummary.render();
    }
    
    
    function onNewPasswordSubmitSuccess( response ) {
        var formError = (response != null && (response.getResponseHeader["formError"] != null));
        if ( !formError ) {
            YAHOO.sun.identity.config.options.passwordDialog.hide();
            passwordUpdateRequired = false;
            if ( configOption == 1 ) {
                document.location = '$context/config/defaultSummary.htm';
            } else if ( configOption == 2 ) {
                //AjaxUtils.load('wizardContainer', "$context/config/wizard/wizard.htm", showWizard);
                YAHOO.sun.identity.config.options.wizard.show();
            } else if ( configOption == 3 ) {
                document.location = '$context/config/existConf.htm';
            }
        }
    }
    
    function submitNewPasswordForm() {
        AjaxUtils.doPost("passwordDialog", "$context/config/newPassword.htm", AjaxUtils.serializeForm("newPasswordForm"), onNewPasswordSubmitSuccess, null);
    }

    function renderPasswordDialog() {
        YAHOO.sun.identity.config.options.passwordDialog = new YAHOO.widget.Dialog("passwordDialog", { width:"280px", draggable: true, fixedcenter: true, modal: true, close: true, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.passwordDialog.render();
    }

    
    
    function showWizard() {
        renderWizard();
        YAHOO.sun.identity.config.options.wizard.show();
    }
    function renderWizard() {
        YAHOO.sun.identity.config.options.wizard = new YAHOO.widget.Panel("wizard", { fixedcenter: true, modal: true, close: true, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.wizard.render();
    }
    
    function setOption( inOption ) {
        configOption = inOption;
        if (inOption == 1) {
            YAHOO.sun.identity.config.options.defaultSummary.show();
        } else {
            YAHOO.sun.identity.config.options.passwordDialog.show();
        }
    }    
    
    /* #end
     */

    function init() {
        YAHOO.sun.identity.config.options.inProgress = new YAHOO.widget.Panel("inProgress", { fixedcenter: true, modal:true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.inProgress.render();
        
        YAHOO.sun.identity.config.options.confComplete = new YAHOO.widget.Panel("confComplete", { fixedcenter: true, modal:true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.confComplete.render();
        /* #if ( $upgrade )
         */
        YAHOO.sun.identity.config.options.confirmUpgrade = new YAHOO.widget.Panel("confirmUpgrade", { fixedcenter: true, modal: true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.confirmUpgrade.render();

        YAHOO.sun.identity.config.options.upgradePartiallyComplete = new YAHOO.widget.Panel("upgradePartiallyComplete", { fixedcenter: true, modal: true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.upgradePartiallyComplete.render();

        YAHOO.sun.identity.config.options.upgradeComplete = new YAHOO.widget.Panel("upgradeComplete", { fixedcenter: true, modal: true, close: false, visible:false, constraintoviewport:true });
        YAHOO.sun.identity.config.options.upgradeComplete.render();

        YAHOO.sun.identity.config.options.upgrading = new YAHOO.widget.Panel("upgrading", { width:"240px", fixedcenter:true, close:false, draggable:false, zindex:4, modal:true, visible:false });
        YAHOO.sun.identity.config.options.upgrading.setHeader("Upgrading configuration.  Please wait...");
        YAHOO.sun.identity.config.options.upgrading.setBody('<img src="$context/assets/images/rel_interstitial_loading.gif" />');
        YAHOO.sun.identity.config.options.upgrading.render(document.body);

        YAHOO.util.Event.addListener("upgradeLink", "click", showConfirmUpgradePanel );
        YAHOO.util.Event.addListener("confirmUpgradeLink", "click", upgrade );
        YAHOO.util.Event.addListener("cancelUpgradeLink", "click", cancelUpgrade );

        YAHOO.util.Event.addListener("coexistLink", "click", coexist );
        YAHOO.util.Event.addListener("upgradeOlderLink", "click", upgradeOlder );

        YAHOO.util.Event.addListener("downloadInstructionsLink", "click", downloadInstructions );

        YAHOO.util.Event.addListener("launchConsoleLink1", "click", launchConsole );
        YAHOO.util.Event.addListener("launchConsoleLink2", "click", launchConsole );

        /* #else 
        */
        AjaxUtils.load('passwordDialogContainer', "$context/config/newPassword.htm", renderPasswordDialog);
        AjaxUtils.load('defaultSummaryContainer', "$context/config/defaultSummary.htm", renderDefaultSummary);
        AjaxUtils.load('wizardContainer', "$context/config/wizard/wizard.htm", renderWizard);
        /* #end
        */
    }
        
    YAHOO.util.Event.onDOMReady(init);

</script>

<link rel="stylesheet" type="text/css" href="$context/assets/css/Specific/optionUpgrade.css" />

<div id="container" align="center">
    
    <div id="options" align="left" style="width:800px">
        #if ( $upgrade )
        <h1>$page.getLocalizedString("configuration.options.upgrade_available.title")</h1>
        <h4>$page.getLocalizedString("configuration.options.upgrade_available.subtitle")</h4>
        #else
        <h1>$page.getLocalizedString("configuration.options.configuration_options.title")</h1>
        <h4>$page.getLocalizedString("configuration.options.configuration_options.subtitle")</h4>
        #end

        <div class="borderRight">
            #if ( $upgrade )
            <h3>$page.getLocalizedString("configuration.options.upgrade_to_fam.title")</h3>
            $page.getLocalizedString("configuration.options.upgrade_to_fam.description")
            <a id="upgradeLink" class="blue pointer">$page.getLocalizedString("configuration.options.upgrade_to_fam.upgrade_to_fam_link")</a>
            #else
            <h3>$page.getLocalizedString("configuration.options.demo_evaluation.title")</h3>
            $page.getLocalizedString("configuration.options.demo_evaluation.description")
            <a id="DemoConfiguration" class="blue pointer" onclick="setOption(1);">$page.getLocalizedString("configuration.options.demo_evaluation.demo_configuration")</a>
            #end
        </div>
        <div>
            #if( $upgrade )
            <h3>$page.getLocalizedString("configuration.options.existing_configuration.title")</h3>
            <p>$page.getLocalizedString("configuration.options.existing_configuration.description")</p>
            <a id="coexistLink" class="blue pointer">$page.getLocalizedString("configuration.options.existing_configuration.existing_configuration_link")</a>
            #else
            <h3>$page.getLocalizedString("configuration.options.custom_configuration.title")</h3>
            <p>$page.getLocalizedString("configuration.options.custom_configuration.description")</p>
            <a id="CreateNewConf" class="blue pointer" onclick="setOption(2);">$page.getLocalizedString("configuration.options.custom_configuration.create_new_configuration")</a>
            #end
        </div>
        <!--
        <div>
            #if( $upgrade )
            <h3>$page.getLocalizedString("configuration.options.upgrade_older_version.title")</h3>
            <p>$page.getLocalizedString("configuration.options.upgrade_older_version.description")</p>
            <a id="upgradeOlderLink" class="blue pointer">$page.getLocalizedString("configuration.options.upgrade_older_version.upgrade_older_version_link")</a>
            #else
            <h3>$page.getLocalizedString("configuration.options.user_existing_configuration.title")</h3>
            <p>$page.getLocalizedString("configuration.options.user_existing_configuration.description")</p>
            <a id="ExistingConfiguration" class="blue pointer" onclick="setOption(3);">$page.getLocalizedString("configuration.options.user_existing_configuration.add_to_existing_configuration_link")</a>
            #end
        </div>
        -->
    </div>
</div>
#if ( $upgrade )
<style type="text/css">
	div.colum{
		width:280px;
		float:left;
		padding:5px;
		text-align:left;
	}
</style>
<div id="confirmUpgrade" align="center" style="width:600px;visibility:hidden">
    <div class="hd">$page.getLocalizedString("configuration.options.confirm_upgrade.header")</div>
    <div class="bd" style="background-color: white; height: 150px">
		<h2>$page.getLocalizedString("configuration.options.confirm_upgrade.body")</h2>
        <div class="colum">
            <p>$page.getLocalizedString("configuration.options.confirm_upgrade.yes")</p>
		    <a id="confirmUpgradeLink" class="blueSmall pointer">$page.getLocalizedString("configuration.options.confirm_upgrade.yes_link")</a>
		</div>
		<div class="colum">
            <p>$page.getLocalizedString("configuration.options.confirm_upgrade.no")</p>
            <a id="cancelUpgradeLink" class="blueSmall pointer">$page.getLocalizedString("configuration.options.confirm_upgrade.yes_link")</a>
        </div>
    </div>
</div>
<div id="upgradePartiallyComplete" style="width:400px;visibility:hidden">
  <div class="hd">$page.getLocalizedString("configuration.options.upgrade_complete1.header1")</div>
    <div class="bd" style="background-color: white">
	    <h2>$page.getLocalizedString("configuration.options.upgrade_complete1.header2")</h2>
        $page.getLocalizedString("configuration.options.upgrade_complete1.body")
	    <p align="center" class="blue">
            <a id="downloadInstructionsLink" class="blueSmall pointer">$page.getLocalizedString("configuration.options.upgrade_complete1.download_link")</a> |
            <a id="launchConsoleLink1" class="blueSmall pointer">$page.getLocalizedString("configuration.options.upgrade_complete1.launch")</a>
        </p>
    </div>
</div>
<div id="upgradeComplete" style="width:400px;visibility:hidden">
    <div class="hd">$page.getLocalizedString("configuration.options.upgrade_complete2.header")</div>
    <div class="bd" style="background-color: white; text-align: center">
	    <h2>$page.getLocalizedString("configuration.options.upgrade_complete2.body")</h2>
	    <a id="launchConsoleLink2" class="blueSmall pointer">$page.getLocalizedString("configuration.options.upgrade_complete2.launch_link")</a>
    </div>
</div>
#else
    <div id="passwordDialogContainer"></div>
    <div id="defaultSummaryContainer"></div>
    <div id="wizardContainer"></div>
    
    <div id="inProgress" style="visibility:hidden">
        <div class="header"> </div>
        <div class="bd">
            <div class="bodyPopup borderPopUpGray" align="center" style="background:#FFFFFF">
                <br/>
                <h2>Configuration in progress...</h2>
                <img src="$context/assets/images/rel_interstitial_loading.gif" />
            </div>
        </div>
    </div>
    
    <div id="confComplete" style="visibility:hidden">
        <div class="header">Configuration Complete</div>
        <div class="bd">
            <div class="bodyPopup borderPopUpGray" align="center" style="background:#FFFFFF">

                <br>
                <h1>Configuration Complete!</h1>
                <br/>
                What would you like to do next?
                <br/>
                <p align="center" class="blueSmall">
                    <a class="pointer" href="#" onclick="launchConsole(); return false">Proceed to Login Page</a>&nbsp;|&nbsp;<a class="pointer" href="#" onclick="startNewConfig(); return false">Create another FAM instance</a>
                </div>
        </div>
    </div>
#end


